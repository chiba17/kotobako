<html lang="ja"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImE3ZTI3MWMzMmJkMTBkY2EwNTExOThmNjkwNjc3MGEzN2Q0MmRhM2IiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwNzE1ODkwNzg2MDAyMzE4NTExOCIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjX2ZiNWZjMjU5YTkwZjg4ZWVfaW5kZXguaHRtbC0yMDYifSwiZXhwIjoxNzY4NTQ2MzcwLCJpYXQiOjE3Njg1NDI3NzAsImFsZyI6IlJTMjU2In0.G2aauKUSWZ1x3OzasZSsqtNLICljDZZxWGYcXFnwxUHL5F-Ku60Vz7Gi261nQj6qEhGVxnBR_eXN1jbkMUzvvr_PpxjloS7MgmJR0mkZcxplm83HhhMnqac68plcyqmqdE-Tk5CBbN3pQ6gTm72roM9QtTx8vpFRwSczCoxvDtgOXyVJp6FYymzFdQpW9Ea7AWVEc5WILyzV_YRbyiVFjRIsYzmJ_4uZnYFmaVERwqIOtP84VN4qfNoL9kOgwa6zjVmlw3pPCKeb3U6AcNVewQoU7VZS-CsArBs43AcSCEU93y5bJxee-r7wvgwqZaH3xF0JEwyQnZMLli0iDwO3yw","c_fb5fc259a90f88ee_index.html-206")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#fafaf9">
<title>Kotobako</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&amp;display=swap" rel="stylesheet">
<!-- Import Map -->
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "firebase/app": "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"
  }
}
</script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin="anonymous"></script>
<style>
  body { font-family: 'Noto Serif JP', serif; -webkit-tap-highlight-color: transparent; }
  .pb-safe-area { padding-bottom: env(safe-area-inset-bottom); }
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  textarea::placeholder, input::placeholder { color: #d6d3d1; }
  @keyframes floatUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  .animate-float-up { animation: floatUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .animate-fade-in { animation: fadeIn 0.3s ease-out; }
</style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.fixed{position:fixed}.relative{position:relative}.bottom-6{bottom:1.5rem}.left-0{left:0px}.right-0{right:0px}.top-0{top:0px}.z-40{z-index:40}.z-50{z-index:50}.-mr-2{margin-right:-0.5rem}.flex{display:flex}.h-screen{height:100vh}.h-16{height:4rem}.h-\[100dvh\]{height:100dvh}.h-full{height:100%}.w-20{width:5rem}.flex-grow{flex-grow:1}.cursor-default{cursor:default}.select-none{-webkit-user-select:none;user-select:none}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:0.25rem}.gap-3{gap:0.75rem}.overflow-hidden{overflow:hidden}.rounded-full{border-radius:9999px}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-stone-200{--tw-border-opacity:1;border-color:rgb(231 229 228 / var(--tw-border-opacity, 1))}.border-stone-700{--tw-border-opacity:1;border-color:rgb(68 64 60 / var(--tw-border-opacity, 1))}.bg-stone-50{--tw-bg-opacity:1;background-color:rgb(250 250 249 / var(--tw-bg-opacity, 1))}.bg-stone-50\/90{background-color:rgb(250 250 249 / 0.9)}.bg-stone-900{--tw-bg-opacity:1;background-color:rgb(28 25 23 / var(--tw-bg-opacity, 1))}.p-2{padding:0.5rem}.p-6{padding:1.5rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-4{padding-top:1rem;padding-bottom:1rem}.text-center{text-align:center}.font-serif{font-family:ui-serif, Georgia, Cambria, "Times New Roman", Times, serif}.font-sans{font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.italic{font-style:italic}.tracking-tight{letter-spacing:-0.025em}.tracking-widest{letter-spacing:0.1em}.text-stone-400{--tw-text-opacity:1;color:rgb(168 162 158 / var(--tw-text-opacity, 1))}.text-stone-50{--tw-text-opacity:1;color:rgb(250 250 249 / var(--tw-text-opacity, 1))}.text-stone-800{--tw-text-opacity:1;color:rgb(41 37 36 / var(--tw-text-opacity, 1))}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.backdrop-blur-md{--tw-backdrop-blur:blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.selection\:bg-stone-200 *::selection{--tw-bg-opacity:1;background-color:rgb(231 229 228 / var(--tw-bg-opacity, 1))}.selection\:bg-stone-200::selection{--tw-bg-opacity:1;background-color:rgb(231 229 228 / var(--tw-bg-opacity, 1))}.hover\:bg-stone-800:hover{--tw-bg-opacity:1;background-color:rgb(41 37 36 / var(--tw-bg-opacity, 1))}.hover\:text-stone-800:hover{--tw-text-opacity:1;color:rgb(41 37 36 / var(--tw-text-opacity, 1))}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:opacity-70:active{opacity:0.7}</style><script type="module">function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
import React, { useState, useEffect, useRef } from 'react';
import { createRoot } from 'react-dom/client';
import * as LucideIcons from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, onAuthStateChanged, setPersistence, browserLocalPersistence } from 'firebase/auth';
import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, onSnapshot, query } from 'firebase/firestore';
var {
  PenLine,
  Sparkles,
  Check,
  ChevronRight,
  ChevronLeft,
  ArrowLeft,
  Edit2,
  Trash2,
  Menu,
  Copy,
  RefreshCw,
  X,
  AlertCircle
} = LucideIcons;
var firebaseConfig = {
  "apiKey": "AIzaSyBLw99hdYwzQKaWFacV3HdIAsa_adAna9k",
  "authDomain": "kotobako-ec686.firebaseapp.com",
  "projectId": "kotobako-ec686",
  "storageBucket": "kotobako-ec686.firebasestorage.app",
  "messagingSenderId": "836620257824",
  "appId": "1:836620257824:web:5a76bf0e646e37f1fb4a45",
  "measurementId": "G-9XDCCZ1BDM"
};
var app = initializeApp(firebaseConfig);
var auth = getAuth(app);
var db = getFirestore(app);
var appId = 'koto-no-ha-app';
var CATEGORIES = ["心に残った", "新たな気づき", "おもしろい", "役立ちそう"];
var generateShortCode = () => {
  var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  var result = '';
  for (var i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
  result += '-';
  for (var _i = 0; _i < 4; _i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
  return result;
};
var Header = _ref => {
  var {
    onTitleClick,
    leftActions,
    rightActions
  } = _ref;
  return /*#__PURE__*/React.createElement("header", {
    className: "fixed top-0 left-0 right-0 z-50 h-16 bg-stone-50/90 backdrop-blur-md border-b border-stone-200 px-6 flex items-center justify-between shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-20 flex justify-start items-center"
  }, leftActions), /*#__PURE__*/React.createElement("h1", {
    onClick: onTitleClick,
    className: "text-xl font-serif font-bold tracking-tight text-stone-800 cursor-default select-none active:opacity-70 transition-opacity",
    title: "\u30C8\u30EA\u30D7\u30EB\u30AF\u30EA\u30C3\u30AF\u3067\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9"
  }, "Kotobako"), /*#__PURE__*/React.createElement("div", {
    className: "w-20 flex justify-end items-center gap-1"
  }, rightActions));
};
var SyncSettingsView = _ref2 => {
  var {
    currentShortCode,
    isLoadingCode,
    errorMsg,
    onRetryCode,
    onSyncCode,
    onRequestReset,
    showToast
  } = _ref2;
  var [inputId, setInputId] = useState('');
  var handleCopy = () => {
    if (!currentShortCode || currentShortCode.length < 8) return;
    navigator.clipboard.writeText(currentShortCode);
    showToast("同期コードをコピーしました");
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "flex flex-col h-full max-w-md mx-auto p-6 pt-6 pb-24 animate-fade-in overflow-y-auto no-scrollbar"
  }, /*#__PURE__*/React.createElement("div", {
    className: "space-y-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("label", {
    className: "text-stone-500 text-[10px] font-bold tracking-widest uppercase block ml-1"
  }, "\u3042\u306A\u305F\u306E\u540C\u671F\u30B3\u30FC\u30C9"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 bg-white p-4 rounded-xl border border-stone-200 shadow-sm"
  }, /*#__PURE__*/React.createElement("code", {
    className: "flex-grow text-xl font-mono font-bold text-stone-800 tracking-tighter text-center"
  }, isLoadingCode ? '...' : errorMsg ? 'エラー' : currentShortCode), /*#__PURE__*/React.createElement("button", {
    onClick: handleCopy,
    disabled: !currentShortCode || currentShortCode.includes('...'),
    className: "p-2 text-stone-400 hover:text-stone-800 bg-stone-50 rounded-lg active:scale-95 transition-all disabled:opacity-30"
  }, /*#__PURE__*/React.createElement(Copy, {
    size: 20
  }))), errorMsg && /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-center gap-2 text-red-400 text-xs mt-2"
  }, /*#__PURE__*/React.createElement(AlertCircle, {
    size: 14
  }), /*#__PURE__*/React.createElement("span", null, errorMsg), /*#__PURE__*/React.createElement("button", {
    onClick: onRetryCode,
    className: "underline"
  }, "\u518D\u8A66\u884C")), /*#__PURE__*/React.createElement("p", {
    className: "text-[10px] text-stone-400 leading-relaxed italic px-1"
  }, "\u3053\u306E8\u6587\u5B57\u3092\u5225\u306E\u7AEF\u672B\u3067\u5165\u529B\u3059\u308B\u3068\u3001\u8A00\u8449\u3092\u540C\u671F\u3067\u304D\u307E\u3059\u3002")), /*#__PURE__*/React.createElement("div", {
    className: "relative"
  }, /*#__PURE__*/React.createElement("div", {
    className: "absolute inset-0 flex items-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-full border-t border-stone-100"
  })), /*#__PURE__*/React.createElement("div", {
    className: "relative flex justify-center text-[10px] uppercase"
  }, /*#__PURE__*/React.createElement("span", {
    className: "bg-stone-50 px-3 text-stone-300 font-bold tracking-widest"
  }, "or"))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("label", {
    className: "text-stone-500 text-[10px] font-bold tracking-widest uppercase block ml-1"
  }, "\u5225\u306E\u30B3\u30FC\u30C9\u3068\u540C\u671F\u3059\u308B"), /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: inputId,
    onChange: e => setInputId(e.target.value.toUpperCase()),
    placeholder: "\u4F8B: ABCD-1234",
    className: "w-full bg-white border border-stone-200 p-4 rounded-xl text-lg text-center focus:outline-none focus:border-stone-400 font-mono font-bold shadow-sm"
  }), /*#__PURE__*/React.createElement("button", {
    onClick: () => onSyncCode(inputId),
    disabled: !inputId.trim() || inputId.length < 9,
    className: "w-full py-4 bg-stone-900 text-stone-50 rounded-xl font-bold text-sm tracking-widest disabled:opacity-30 transition-all active:scale-[0.98] shadow-md"
  }, "\u540C\u671F\u3092\u958B\u59CB\u3059\u308B"), /*#__PURE__*/React.createElement("p", {
    className: "text-[10px] text-stone-400 leading-relaxed italic px-1 text-center"
  }, "\u203B\u5165\u529B\u3057\u305F\u30B3\u30FC\u30C9\u306E\u30C7\u30FC\u30BF\u306B\u5207\u308A\u66FF\u308F\u308A\u307E\u3059\u3002")), /*#__PURE__*/React.createElement("div", {
    className: "pt-8 mt-8 border-t border-stone-100"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onRequestReset,
    className: "w-full py-4 text-red-400 hover:text-red-600 text-xs font-bold tracking-widest transition-colors flex items-center justify-center gap-2"
  }, /*#__PURE__*/React.createElement(Trash2, {
    size: 16
  }), /*#__PURE__*/React.createElement("span", null, "\u5168\u30C7\u30FC\u30BF\u3092\u524A\u9664\u3057\u3066\u521D\u671F\u5316")))));
};
var Toast = _ref3 => {
  var {
    message,
    isVisible,
    onHide
  } = _ref3;
  useEffect(() => {
    if (isVisible) {
      var timer = setTimeout(onHide, 2000);
      return () => clearTimeout(timer);
    }
  }, [isVisible, onHide]);
  if (!isVisible) return null;
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] animate-fade-in pointer-events-none"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-stone-800 text-stone-50 px-4 py-2 rounded-full shadow-lg text-sm font-medium flex items-center gap-2 border border-stone-700"
  }, /*#__PURE__*/React.createElement(Check, {
    size: 14
  }), message));
};
var ConfirmDialog = _ref4 => {
  var {
    isVisible,
    title,
    message,
    actionLabel,
    onConfirm,
    onCancel
  } = _ref4;
  if (!isVisible) return null;
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 z-[80] flex items-center justify-center p-6 bg-stone-900/40 backdrop-blur-sm animate-fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl p-8 max-w-xs w-full shadow-xl text-center"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-stone-800 mb-2 font-serif"
  }, title), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-stone-500 mb-8 leading-relaxed"
  }, message), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onConfirm,
    className: "w-full py-3 bg-stone-900 text-stone-50 rounded-lg font-bold text-sm hover:bg-stone-800 transition-colors"
  }, actionLabel), /*#__PURE__*/React.createElement("button", {
    onClick: onCancel,
    className: "w-full py-3 bg-stone-100 text-stone-600 rounded-lg font-bold text-sm hover:bg-stone-200 transition-colors"
  }, "\u30AD\u30E3\u30F3\u30BB\u30EB"))));
};
// bottom-10 -> bottom-6 に修正
var FloatingWriteButton = _ref5 => {
  var {
    onClick
  } = _ref5;
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed bottom-6 left-0 right-0 flex justify-center z-40 px-6 pointer-events-none"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClick,
    className: "bg-stone-900 text-stone-50 px-8 py-4 rounded-full shadow-2xl flex items-center gap-3 border border-stone-700 pointer-events-auto active:scale-95 transition-all duration-300 hover:bg-stone-800 animate-float-up"
  }, /*#__PURE__*/React.createElement(PenLine, {
    size: 20,
    strokeWidth: 2.5
  }), /*#__PURE__*/React.createElement("span", {
    className: "text-sm font-bold tracking-widest"
  }, "\u8A18\u3059")));
};
var InputView = _ref6 => {
  var {
    onSave,
    initialData = null
  } = _ref6;
  var [text, setText] = useState(initialData ? initialData.text : '');
  var [source, setSource] = useState(initialData ? initialData.source : '');
  var [selectedCategory, setSelectedCategory] = useState(initialData ? initialData.category : CATEGORIES[0]);
  var textareaRef = useRef(null);
  useEffect(() => {
    if (initialData) {
      setText(initialData.text);
      setSource(initialData.source || '');
      setSelectedCategory(initialData.category);
    } else {
      setText('');
      setSource('');
      setSelectedCategory(CATEGORIES[0]);
    }
  }, [initialData]);
  useEffect(() => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = "".concat(textareaRef.current.scrollHeight, "px");
    }
  }, [text]);
  var handleSave = () => {
    if (text.trim()) onSave(text, source, selectedCategory);
  };
  var isEditMode = !!initialData;
  return (
    /*#__PURE__*/
    // overflow-y-auto no-scrollbar を追加して、画面固定時もスクロール可能に
    React.createElement("div", {
      className: "flex flex-col h-full max-w-md mx-auto p-6 pt-8 pb-24 animate-fade-in overflow-y-auto no-scrollbar"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex-grow flex flex-col gap-6"
    }, /*#__PURE__*/React.createElement("label", {
      className: "text-stone-500 text-xs font-bold tracking-widest uppercase select-none cursor-default active:text-stone-800 transition-colors"
    }, isEditMode ? '言葉を編集する' : '言葉を記す'), /*#__PURE__*/React.createElement("textarea", {
      ref: textareaRef,
      value: text,
      onChange: e => setText(e.target.value),
      placeholder: "\u5FC3\u306B\u6B8B\u3063\u305F\u8A00\u8449\u3092\u5165\u529B...",
      className: "w-full min-h-[8rem] bg-transparent text-lg leading-relaxed text-stone-800 placeholder:text-stone-300 resize-none focus:outline-none font-serif overflow-hidden",
      autoFocus: !isEditMode
    }), /*#__PURE__*/React.createElement("input", {
      type: "text",
      value: source,
      onChange: e => setSource(e.target.value),
      placeholder: "\u51FA\u5178\uFF08\u4EFB\u610F\uFF09",
      className: "w-full bg-transparent border-b border-stone-200 py-2 mb-4 focus:outline-none focus:border-stone-400 text-sm font-serif text-stone-600 placeholder:text-stone-200"
    }), /*#__PURE__*/React.createElement("div", {
      className: "space-y-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 gap-2"
    }, CATEGORIES.map(cat => /*#__PURE__*/React.createElement("button", {
      key: cat,
      onClick: () => setSelectedCategory(cat),
      className: "py-3 px-2 text-sm rounded transition-all duration-200 border ".concat(selectedCategory === cat ? 'bg-stone-800 text-stone-50 border-stone-800 shadow-md' : 'bg-white text-stone-600 border-stone-200 hover:border-stone-400')
    }, cat))))), /*#__PURE__*/React.createElement("div", {
      className: "pt-6 pb-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: handleSave,
      disabled: !text.trim(),
      className: "w-full py-4 rounded-lg font-bold tracking-widest transition-all duration-200 ".concat(text.trim() ? 'bg-stone-800 text-stone-50 shadow-lg hover:bg-stone-700 active:scale-[0.98]' : 'bg-stone-200 text-stone-400 cursor-not-allowed')
    }, isEditMode ? '更新する' : '保存する')))
  );
};
var ListView = _ref7 => {
  var {
    quotes,
    onItemClick,
    onStartRandom
  } = _ref7;
  if (quotes.length === 0) return /*#__PURE__*/React.createElement("div", {
    className: "flex flex-col items-center justify-center h-full text-stone-400 p-6 text-center italic font-serif"
  }, "\u307E\u3060\u8A00\u8449\u304C\u3042\u308A\u307E\u305B\u3093\u3002\u4E0B\u306E\u300C\u8A18\u3059\u300D\u304B\u3089\u59CB\u3081\u307E\u3057\u3087\u3046\u3002");
  return /*#__PURE__*/React.createElement("div", {
    className: "h-full overflow-y-auto max-w-md mx-auto p-6 pb-32 no-scrollbar"
  }, /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onStartRandom,
    className: "w-full flex items-center justify-between p-6 bg-stone-100 border border-stone-200 rounded-2xl hover:bg-stone-200 transition-all group active:scale-[0.98]"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white p-3 rounded-xl shadow-sm text-stone-800 group-hover:rotate-12 transition-transform"
  }, /*#__PURE__*/React.createElement(Sparkles, {
    size: 24
  })), /*#__PURE__*/React.createElement("div", {
    className: "text-left"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm font-bold text-stone-800 tracking-wider"
  }, "\u8A00\u8449\u3068\u306E\u518D\u4F1A"), /*#__PURE__*/React.createElement("p", {
    className: "text-[10px] text-stone-400 font-serif"
  }, "\u3044\u3064\u304B\u306E\u8A00\u8449\u306B\u3001\u307E\u305F\u51FA\u4F1A\u3046"))), /*#__PURE__*/React.createElement(ChevronRight, {
    className: "text-stone-300 group-hover:text-stone-50 transition-colors",
    size: 20
  })), quotes.map(quote => /*#__PURE__*/React.createElement("div", {
    key: quote.id,
    onClick: () => onItemClick(quote.id),
    className: "group bg-white p-6 rounded-2xl border border-stone-100 hover:border-stone-300 transition-all cursor-pointer active:bg-stone-50 shadow-sm text-left"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-base leading-relaxed text-stone-800 whitespace-pre-wrap mb-1 font-serif line-clamp-3"
  }, quote.text), quote.source && /*#__PURE__*/React.createElement("p", {
    className: "text-[10px] text-stone-400 font-serif mb-3 tracking-wide"
  }, "\u2014 ", quote.source), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-end border-t border-stone-50 pt-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-xs text-stone-500 bg-stone-100 px-2 py-1 rounded-lg font-medium"
  }, quote.category), /*#__PURE__*/React.createElement("span", {
    className: "text-[10px] text-stone-400 font-mono"
  }, new Date(quote.timestamp).toLocaleDateString('ja-JP')))))));
};
var SingleQuoteView = _ref8 => {
  var {
    quote,
    onNext,
    onPrev,
    hasNext,
    hasPrev,
    nextLabel,
    nextIcon: NextIcon,
    onClose
  } = _ref8;
  return /*#__PURE__*/React.createElement("div", {
    className: "flex flex-col h-full max-w-md mx-auto p-8 pb-8 relative animate-fade-in bg-stone-50 overflow-y-auto no-scrollbar"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex-grow flex flex-col items-center justify-center py-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-full text-center"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-3 py-1 rounded-full border border-stone-200 text-xs text-stone-500 tracking-wide mb-8"
  }, quote.category), /*#__PURE__*/React.createElement("div", {
    className: "px-2"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xl md:text-2xl font-serif text-stone-800 whitespace-pre-wrap mb-4 select-text",
    style: {
      lineHeight: '1.8'
    }
  }, quote.text), quote.source && /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-stone-500 font-serif mb-8"
  }, "\u2014 ", quote.source), /*#__PURE__*/React.createElement("div", {
    className: "mt-8 flex justify-center text-stone-300"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-px w-12 bg-stone-300"
  })), /*#__PURE__*/React.createElement("p", {
    className: "mt-4 text-[10px] text-stone-400 font-mono tracking-widest"
  }, new Date(quote.timestamp).toLocaleDateString('ja-JP'))))), /*#__PURE__*/React.createElement("div", {
    className: "pt-6 pb-32 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3 mb-6 min-h-[64px]"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-16"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onPrev,
    disabled: !hasPrev,
    className: "w-full h-full border border-stone-300 rounded-lg text-stone-400 enabled:hover:text-stone-800 transition-all duration-200 bg-white flex items-center justify-center disabled:opacity-30"
  }, /*#__PURE__*/React.createElement(ChevronLeft, {
    size: 20
  }))), /*#__PURE__*/React.createElement("div", {
    className: "flex-grow"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onNext,
    disabled: !hasNext,
    className: "w-full h-full border border-stone-300 rounded-lg text-stone-600 enabled:hover:text-stone-800 hover:border-stone-400 transition-all duration-200 flex items-center justify-center gap-2 bg-white shadow-sm disabled:opacity-30"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-sm font-bold tracking-widest"
  }, nextLabel), /*#__PURE__*/React.createElement(NextIcon, {
    size: 16
  })))), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "text-xs text-stone-400 hover:text-stone-600 transition-colors tracking-widest font-bold py-2 px-4"
  }, "\u4E00\u89A7\u306B\u623B\u308B")));
};
var App = () => {
  var [user, setUser] = useState(null);
  var [shortCode, setShortCode] = useState('');
  var [isLoadingCode, setIsLoadingCode] = useState(false);
  var [codeError, setCodeError] = useState(null);
  var [syncUserId, setSyncUserId] = useState(null);
  var [viewMode, setViewMode] = useState('list');
  var [selectedQuoteId, setSelectedQuoteId] = useState(null);
  var [randomHistory, setRandomHistory] = useState([]);
  var [quotes, setQuotes] = useState([]);
  var [toast, setToast] = useState({
    show: false,
    message: ''
  });
  var [dialogState, setDialogState] = useState({
    isVisible: false,
    type: null,
    id: null
  });
  var [clickCount, setClickCount] = useState(0);
  var clickTimeoutRef = useRef(null);

  // ユーザー情報を取得・初期化する（ログイン処理はしない）
  var fetchUserData = /*#__PURE__*/function () {
    var _ref9 = _asyncToGenerator(function* (currentUser) {
      if (!currentUser) return;
      setIsLoadingCode(true);
      setCodeError(null);
      try {
        var userCodeRef = doc(db, 'artifacts', appId, 'public', 'data', 'userCodes', currentUser.uid);
        var codeSnap = yield getDoc(userCodeRef);
        if (codeSnap.exists()) {
          setShortCode(codeSnap.data().code);
        } else {
          var newCode = generateShortCode();
          yield setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'syncCodes', newCode), {
            uid: currentUser.uid
          });
          yield setDoc(userCodeRef, {
            code: newCode
          });
          setShortCode(newCode);
        }
      } catch (e) {
        console.error("Fetch Error:", e);
        var msg = "接続エラー";
        if (e.code === 'permission-denied') msg = "権限がありません";
        setCodeError(msg);
      } finally {
        setIsLoadingCode(false);
      }
    });
    return function fetchUserData(_x) {
      return _ref9.apply(this, arguments);
    };
  }();

  // アプリ起動時の認証フロー監視
  useEffect(() => {
    // 明示的に永続化を設定
    setPersistence(auth, browserLocalPersistence).then(() => {
      var unsubscribe = onAuthStateChanged(auth, u => {
        if (u) {
          // 既にログイン済み（リロード時など）または新規ログイン完了時
          setUser(u);
          fetchUserData(u);
        } else {
          // ユーザーがいない（初回アクセス、またはログアウト後）
          // 匿名ログインを実行
          signInAnonymously(auth).catch(e => {
            console.error("Auth Error:", e);
            var msg = "認証エラー";
            if (e.code === 'auth/operation-not-allowed') msg = "匿名ログインが無効です";
            setCodeError(msg);
          });
        }
      });
      return () => unsubscribe();
    }).catch(error => {
      console.error("Persistence Error:", error);
      // エラー時でも監視は開始する
      onAuthStateChanged(auth, u => {
        if (u) {
          setUser(u);
          fetchUserData(u);
        }
      });
    });
  }, []);
  var activeUserId = syncUserId || (user ? user.uid : null);
  useEffect(() => {
    if (!activeUserId) {
      setQuotes([]);
      return;
    }
    var q = query(collection(db, 'artifacts', appId, 'users', activeUserId, 'quotes'));
    var unsubscribe = onSnapshot(q, snapshot => {
      var docs = snapshot.docs.map(doc => _objectSpread({
        id: doc.id
      }, doc.data()));
      setQuotes(docs.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)));
    }, err => {
      console.error("Firestore Sync Error:", err);
    });
    return () => unsubscribe();
  }, [activeUserId]);
  var showToast = message => setToast({
    show: true,
    message
  });
  var handleSyncByCode = /*#__PURE__*/function () {
    var _ref0 = _asyncToGenerator(function* (code) {
      if (!user) return;
      var cleanCode = code.trim().toUpperCase();
      try {
        var mappingRef = doc(db, 'artifacts', appId, 'public', 'data', 'syncCodes', cleanCode);
        var mappingSnap = yield getDoc(mappingRef);
        if (mappingSnap.exists()) {
          setSyncUserId(mappingSnap.data().uid);
          setViewMode('list');
          showToast("同期を開始しました");
        } else {
          showToast("コードが見つかりません");
        }
      } catch (e) {
        showToast("同期エラーが発生しました");
      }
    });
    return function handleSyncByCode(_x2) {
      return _ref0.apply(this, arguments);
    };
  }();
  var addQuote = /*#__PURE__*/function () {
    var _ref1 = _asyncToGenerator(function* (text, source, category) {
      if (!activeUserId) return;
      yield addDoc(collection(db, 'artifacts', appId, 'users', activeUserId, 'quotes'), {
        text,
        source,
        category,
        timestamp: Date.now()
      });
      showToast("言葉を保存しました");
      setViewMode('list');
    });
    return function addQuote(_x3, _x4, _x5) {
      return _ref1.apply(this, arguments);
    };
  }();
  var updateQuote = /*#__PURE__*/function () {
    var _ref10 = _asyncToGenerator(function* (text, source, category) {
      if (!activeUserId || !selectedQuoteId) return;
      yield updateDoc(doc(db, 'artifacts', appId, 'users', activeUserId, 'quotes', selectedQuoteId), {
        text,
        source,
        category
      });
      showToast("言葉を更新しました");
      setViewMode(randomHistory.length > 0 ? 'random' : 'detail');
    });
    return function updateQuote(_x6, _x7, _x8) {
      return _ref10.apply(this, arguments);
    };
  }();
  var handleConfirmAction = /*#__PURE__*/function () {
    var _ref11 = _asyncToGenerator(function* () {
      if (dialogState.type === 'quote') yield confirmDeleteQuote();else if (dialogState.type === 'account') yield confirmResetAccount();
    });
    return function handleConfirmAction() {
      return _ref11.apply(this, arguments);
    };
  }();
  var confirmDeleteQuote = /*#__PURE__*/function () {
    var _ref12 = _asyncToGenerator(function* () {
      if (!activeUserId || !dialogState.id) return;
      yield deleteDoc(doc(db, 'artifacts', appId, 'users', activeUserId, 'quotes', dialogState.id));
      showToast("削除しました");
      setDialogState({
        isVisible: false,
        type: null,
        id: null
      });
      setViewMode('list');
      setSelectedQuoteId(null);
    });
    return function confirmDeleteQuote() {
      return _ref12.apply(this, arguments);
    };
  }();
  var confirmResetAccount = /*#__PURE__*/function () {
    var _ref13 = _asyncToGenerator(function* () {
      if (!user || !shortCode) return;
      try {
        var quotesRef = collection(db, 'artifacts', appId, 'users', user.uid, 'quotes');
        var snap = yield getDocs(quotesRef);
        var deletePromises = snap.docs.map(d => deleteDoc(d.ref));
        yield Promise.all(deletePromises);
        yield deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'syncCodes', shortCode));
        yield deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'userCodes', user.uid));
        showToast("初期化しました。リロードします...");
        setTimeout(() => window.location.reload(), 1500);
      } catch (e) {
        console.error(e);
        showToast("初期化に失敗しました");
        setDialogState({
          isVisible: false,
          type: null,
          id: null
        });
      }
    });
    return function confirmResetAccount() {
      return _ref13.apply(this, arguments);
    };
  }();

  // タイトルをクリックしたときの処理（トリプルクリックでHTMLダウンロード）
  var handleTitleClick = e => {
    // detailプロパティでクリック回数を取得（標準的なブラウザ仕様）
    if (e.detail === 3) {
      var htmlContent = document.documentElement.outerHTML;
      var blob = new Blob([htmlContent], {
        type: 'text/html'
      });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'index.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast("HTMLファイルをダウンロードしました");
    }
  };
  var currentQuoteIndex = quotes.findIndex(q => q.id === selectedQuoteId);
  var currentQuote = quotes[currentQuoteIndex];
  var leftActions = null;
  var rightActions = null;
  switch (viewMode) {
    case 'list':
      rightActions = /*#__PURE__*/React.createElement("button", {
        onClick: () => setViewMode('settings'),
        className: "p-2 -mr-2 text-stone-400 hover:text-stone-800 transition-colors"
      }, /*#__PURE__*/React.createElement(Menu, {
        size: 24
      }));
      break;
    case 'input':
    case 'settings':
      rightActions = /*#__PURE__*/React.createElement("button", {
        onClick: () => setViewMode('list'),
        className: "p-2 -mr-2 text-stone-400 hover:text-stone-800 transition-colors"
      }, /*#__PURE__*/React.createElement(X, {
        size: 24
      }));
      break;
    case 'edit':
      rightActions = /*#__PURE__*/React.createElement("button", {
        onClick: () => setViewMode(randomHistory.length > 0 ? 'random' : 'detail'),
        className: "p-2 -mr-2 text-stone-400 hover:text-stone-800 transition-colors"
      }, /*#__PURE__*/React.createElement(X, {
        size: 24
      }));
      break;
    case 'detail':
    case 'random':
      leftActions = /*#__PURE__*/React.createElement("button", {
        onClick: () => {
          setViewMode('list');
          setRandomHistory([]);
          setSelectedQuoteId(null);
        },
        className: "p-2 -ml-2 text-stone-400 hover:text-stone-800 transition-colors"
      }, /*#__PURE__*/React.createElement(ArrowLeft, {
        size: 24
      }));
      rightActions = /*#__PURE__*/React.createElement("div", {
        className: "flex gap-1 -mr-2"
      }, /*#__PURE__*/React.createElement("button", {
        onClick: () => setDialogState({
          isVisible: true,
          type: 'quote',
          id: selectedQuoteId
        }),
        className: "p-2 text-stone-400 hover:text-red-500 transition-colors"
      }, /*#__PURE__*/React.createElement(Trash2, {
        size: 20
      })), /*#__PURE__*/React.createElement("button", {
        onClick: () => setViewMode('edit'),
        className: "p-2 text-stone-400 hover:text-stone-800 transition-colors"
      }, /*#__PURE__*/React.createElement(Edit2, {
        size: 20
      })));
      break;
  }
  if (!user) return /*#__PURE__*/React.createElement("div", {
    className: "h-screen flex items-center justify-center font-serif text-stone-400 italic"
  }, "\u8AAD\u307F\u8FBC\u307F\u4E2D...");
  return (
    /*#__PURE__*/
    // min-h-screen -> h-[100dvh] に変更して、全体スクロールを防ぐ
    React.createElement("div", {
      className: "h-[100dvh] bg-stone-50 text-stone-800 font-sans selection:bg-stone-200 overflow-hidden flex flex-col"
    }, /*#__PURE__*/React.createElement("style", null, "@media (min-width: 640px) { body { padding-top: 16px; } }"), /*#__PURE__*/React.createElement(Header, {
      onTitleClick: handleTitleClick,
      leftActions: leftActions,
      rightActions: rightActions
    }), /*#__PURE__*/React.createElement("div", {
      className: "flex-grow overflow-hidden relative",
      style: {
        paddingTop: '64px'
      }
    }, /*#__PURE__*/React.createElement("main", {
      className: "h-full relative overflow-hidden"
    }, viewMode === 'input' && /*#__PURE__*/React.createElement(InputView, {
      onSave: addQuote
    }), viewMode === 'list' && /*#__PURE__*/React.createElement(ListView, {
      quotes: quotes,
      onItemClick: id => {
        setSelectedQuoteId(id);
        setViewMode('detail');
      },
      onStartRandom: () => {
        if (quotes.length > 0) {
          var first = quotes[Math.floor(Math.random() * quotes.length)];
          setSelectedQuoteId(first.id);
          setRandomHistory([first.id]);
          setViewMode('random');
        }
      }
    }), viewMode === 'detail' && currentQuote && /*#__PURE__*/React.createElement(SingleQuoteView, {
      quote: currentQuote,
      onNext: () => setSelectedQuoteId(quotes[(currentQuoteIndex + 1) % quotes.length].id),
      onPrev: () => setSelectedQuoteId(quotes[(currentQuoteIndex - 1 + quotes.length) % quotes.length].id),
      hasNext: currentQuoteIndex < quotes.length - 1,
      hasPrev: currentQuoteIndex > 0,
      nextLabel: "\u6B21\u306E\u8A00\u8449\u3078",
      nextIcon: ChevronRight,
      onClose: () => setViewMode('list')
    }), viewMode === 'random' && currentQuote && /*#__PURE__*/React.createElement(SingleQuoteView, {
      quote: currentQuote,
      onNext: () => {
        var n;
        do {
          n = quotes[Math.floor(Math.random() * quotes.length)].id;
        } while (n === selectedQuoteId && quotes.length > 1);
        setSelectedQuoteId(n);
        setRandomHistory(p => [...p, n]);
      },
      onPrev: () => {
        var h = [...randomHistory];
        h.pop();
        var p = h[h.length - 1];
        setSelectedQuoteId(p);
        setRandomHistory(h);
      },
      hasNext: quotes.length > 1,
      hasPrev: randomHistory.length > 1,
      nextLabel: "\u5225\u306E\u8A00\u8449\u306B\u51FA\u4F1A\u3046",
      nextIcon: Sparkles,
      onClose: () => setViewMode('list')
    }), viewMode === 'edit' && currentQuote && /*#__PURE__*/React.createElement(InputView, {
      initialData: currentQuote,
      onSave: updateQuote
    }), viewMode === 'settings' && /*#__PURE__*/React.createElement(SyncSettingsView, {
      currentShortCode: shortCode,
      isLoadingCode: isLoadingCode,
      errorMsg: codeError,
      onRetryCode: () => fetchUserData(user),
      onSyncCode: handleSyncByCode,
      onRequestReset: () => setDialogState({
        isVisible: true,
        type: 'account',
        id: null
      }),
      showToast: showToast
    }))), viewMode === 'list' && /*#__PURE__*/React.createElement(FloatingWriteButton, {
      onClick: () => setViewMode('input')
    }), /*#__PURE__*/React.createElement(ConfirmDialog, {
      isVisible: dialogState.isVisible,
      title: dialogState.type === 'account' ? "全データを削除しますか？" : "言葉を削除しますか？",
      message: dialogState.type === 'account' ? "あなたの言葉、設定、同期コードがすべて削除され、アプリが初期化されます。この操作は取り消せません。" : "一度削除した言葉は元に戻すことができません。",
      actionLabel: dialogState.type === 'account' ? "全削除して初期化" : "削除する",
      onConfirm: handleConfirmAction,
      onCancel: () => setDialogState({
        isVisible: false,
        type: null,
        id: null
      })
    }), /*#__PURE__*/React.createElement(Toast, {
      message: toast.message,
      isVisible: toast.show,
      onHide: () => setToast(p => _objectSpread(_objectSpread({}, p), {}, {
        show: false
      }))
    }))
  );
};
var root = createRoot(document.getElementById('root'));
root.render(/*#__PURE__*/React.createElement(App, null));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWFjdCIsInVzZVN0YXRlIiwidXNlRWZmZWN0IiwidXNlUmVmIiwiY3JlYXRlUm9vdCIsIkx1Y2lkZUljb25zIiwiaW5pdGlhbGl6ZUFwcCIsImdldEF1dGgiLCJzaWduSW5Bbm9ueW1vdXNseSIsIm9uQXV0aFN0YXRlQ2hhbmdlZCIsInNldFBlcnNpc3RlbmNlIiwiYnJvd3NlckxvY2FsUGVyc2lzdGVuY2UiLCJnZXRGaXJlc3RvcmUiLCJjb2xsZWN0aW9uIiwiZG9jIiwic2V0RG9jIiwiZ2V0RG9jIiwiZ2V0RG9jcyIsImFkZERvYyIsInVwZGF0ZURvYyIsImRlbGV0ZURvYyIsIm9uU25hcHNob3QiLCJxdWVyeSIsIlBlbkxpbmUiLCJTcGFya2xlcyIsIkNoZWNrIiwiQ2hldnJvblJpZ2h0IiwiQ2hldnJvbkxlZnQiLCJBcnJvd0xlZnQiLCJFZGl0MiIsIlRyYXNoMiIsIk1lbnUiLCJDb3B5IiwiUmVmcmVzaEN3IiwiWCIsIkFsZXJ0Q2lyY2xlIiwiZmlyZWJhc2VDb25maWciLCJhcHAiLCJhdXRoIiwiZGIiLCJhcHBJZCIsIkNBVEVHT1JJRVMiLCJnZW5lcmF0ZVNob3J0Q29kZSIsImNoYXJzIiwicmVzdWx0IiwiaSIsImNoYXJBdCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsIkhlYWRlciIsIl9yZWYiLCJvblRpdGxlQ2xpY2siLCJsZWZ0QWN0aW9ucyIsInJpZ2h0QWN0aW9ucyIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJvbkNsaWNrIiwidGl0bGUiLCJTeW5jU2V0dGluZ3NWaWV3IiwiX3JlZjIiLCJjdXJyZW50U2hvcnRDb2RlIiwiaXNMb2FkaW5nQ29kZSIsImVycm9yTXNnIiwib25SZXRyeUNvZGUiLCJvblN5bmNDb2RlIiwib25SZXF1ZXN0UmVzZXQiLCJzaG93VG9hc3QiLCJpbnB1dElkIiwic2V0SW5wdXRJZCIsImhhbmRsZUNvcHkiLCJuYXZpZ2F0b3IiLCJjbGlwYm9hcmQiLCJ3cml0ZVRleHQiLCJkaXNhYmxlZCIsImluY2x1ZGVzIiwic2l6ZSIsInR5cGUiLCJ2YWx1ZSIsIm9uQ2hhbmdlIiwiZSIsInRhcmdldCIsInRvVXBwZXJDYXNlIiwicGxhY2Vob2xkZXIiLCJ0cmltIiwiVG9hc3QiLCJfcmVmMyIsIm1lc3NhZ2UiLCJpc1Zpc2libGUiLCJvbkhpZGUiLCJ0aW1lciIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJDb25maXJtRGlhbG9nIiwiX3JlZjQiLCJhY3Rpb25MYWJlbCIsIm9uQ29uZmlybSIsIm9uQ2FuY2VsIiwiRmxvYXRpbmdXcml0ZUJ1dHRvbiIsIl9yZWY1Iiwic3Ryb2tlV2lkdGgiLCJJbnB1dFZpZXciLCJfcmVmNiIsIm9uU2F2ZSIsImluaXRpYWxEYXRhIiwidGV4dCIsInNldFRleHQiLCJzb3VyY2UiLCJzZXRTb3VyY2UiLCJzZWxlY3RlZENhdGVnb3J5Iiwic2V0U2VsZWN0ZWRDYXRlZ29yeSIsImNhdGVnb3J5IiwidGV4dGFyZWFSZWYiLCJjdXJyZW50Iiwic3R5bGUiLCJoZWlnaHQiLCJjb25jYXQiLCJzY3JvbGxIZWlnaHQiLCJoYW5kbGVTYXZlIiwiaXNFZGl0TW9kZSIsInJlZiIsImF1dG9Gb2N1cyIsIm1hcCIsImNhdCIsImtleSIsIkxpc3RWaWV3IiwiX3JlZjciLCJxdW90ZXMiLCJvbkl0ZW1DbGljayIsIm9uU3RhcnRSYW5kb20iLCJxdW90ZSIsImlkIiwiRGF0ZSIsInRpbWVzdGFtcCIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIlNpbmdsZVF1b3RlVmlldyIsIl9yZWY4Iiwib25OZXh0Iiwib25QcmV2IiwiaGFzTmV4dCIsImhhc1ByZXYiLCJuZXh0TGFiZWwiLCJuZXh0SWNvbiIsIk5leHRJY29uIiwib25DbG9zZSIsImxpbmVIZWlnaHQiLCJBcHAiLCJ1c2VyIiwic2V0VXNlciIsInNob3J0Q29kZSIsInNldFNob3J0Q29kZSIsInNldElzTG9hZGluZ0NvZGUiLCJjb2RlRXJyb3IiLCJzZXRDb2RlRXJyb3IiLCJzeW5jVXNlcklkIiwic2V0U3luY1VzZXJJZCIsInZpZXdNb2RlIiwic2V0Vmlld01vZGUiLCJzZWxlY3RlZFF1b3RlSWQiLCJzZXRTZWxlY3RlZFF1b3RlSWQiLCJyYW5kb21IaXN0b3J5Iiwic2V0UmFuZG9tSGlzdG9yeSIsInNldFF1b3RlcyIsInRvYXN0Iiwic2V0VG9hc3QiLCJzaG93IiwiZGlhbG9nU3RhdGUiLCJzZXREaWFsb2dTdGF0ZSIsImNsaWNrQ291bnQiLCJzZXRDbGlja0NvdW50IiwiY2xpY2tUaW1lb3V0UmVmIiwiZmV0Y2hVc2VyRGF0YSIsIl9yZWY5IiwiX2FzeW5jVG9HZW5lcmF0b3IiLCJjdXJyZW50VXNlciIsInVzZXJDb2RlUmVmIiwidWlkIiwiY29kZVNuYXAiLCJleGlzdHMiLCJkYXRhIiwiY29kZSIsIm5ld0NvZGUiLCJjb25zb2xlIiwiZXJyb3IiLCJtc2ciLCJfeCIsImFwcGx5IiwiYXJndW1lbnRzIiwidGhlbiIsInVuc3Vic2NyaWJlIiwidSIsImNhdGNoIiwiYWN0aXZlVXNlcklkIiwicSIsInNuYXBzaG90IiwiZG9jcyIsIl9vYmplY3RTcHJlYWQiLCJzb3J0IiwiYSIsImIiLCJlcnIiLCJoYW5kbGVTeW5jQnlDb2RlIiwiX3JlZjAiLCJjbGVhbkNvZGUiLCJtYXBwaW5nUmVmIiwibWFwcGluZ1NuYXAiLCJfeDIiLCJhZGRRdW90ZSIsIl9yZWYxIiwibm93IiwiX3gzIiwiX3g0IiwiX3g1IiwidXBkYXRlUXVvdGUiLCJfcmVmMTAiLCJfeDYiLCJfeDciLCJfeDgiLCJoYW5kbGVDb25maXJtQWN0aW9uIiwiX3JlZjExIiwiY29uZmlybURlbGV0ZVF1b3RlIiwiY29uZmlybVJlc2V0QWNjb3VudCIsIl9yZWYxMiIsIl9yZWYxMyIsInF1b3Rlc1JlZiIsInNuYXAiLCJkZWxldGVQcm9taXNlcyIsImQiLCJQcm9taXNlIiwiYWxsIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJoYW5kbGVUaXRsZUNsaWNrIiwiZGV0YWlsIiwiaHRtbENvbnRlbnQiLCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIsIm91dGVySFRNTCIsImJsb2IiLCJCbG9iIiwidXJsIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiaHJlZiIsImRvd25sb2FkIiwiYm9keSIsImFwcGVuZENoaWxkIiwiY2xpY2siLCJyZW1vdmVDaGlsZCIsInJldm9rZU9iamVjdFVSTCIsImN1cnJlbnRRdW90ZUluZGV4IiwiZmluZEluZGV4IiwiY3VycmVudFF1b3RlIiwicGFkZGluZ1RvcCIsImZpcnN0IiwibiIsInAiLCJoIiwicG9wIiwicm9vdCIsImdldEVsZW1lbnRCeUlkIiwicmVuZGVyIl0sInNvdXJjZXMiOlsiSW5saW5lIEJhYmVsIHNjcmlwdCJdLCJzb3VyY2VzQ29udGVudCI6WyJcbiAgaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcbiAgaW1wb3J0IHsgY3JlYXRlUm9vdCB9IGZyb20gJ3JlYWN0LWRvbS9jbGllbnQnO1xuICBpbXBvcnQgKiBhcyBMdWNpZGVJY29ucyBmcm9tICdsdWNpZGUtcmVhY3QnO1xuICBpbXBvcnQgeyBpbml0aWFsaXplQXBwIH0gZnJvbSAnZmlyZWJhc2UvYXBwJztcbiAgaW1wb3J0IHsgZ2V0QXV0aCwgc2lnbkluQW5vbnltb3VzbHksIG9uQXV0aFN0YXRlQ2hhbmdlZCwgc2V0UGVyc2lzdGVuY2UsIGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlIH0gZnJvbSAnZmlyZWJhc2UvYXV0aCc7XG4gIGltcG9ydCB7IGdldEZpcmVzdG9yZSwgY29sbGVjdGlvbiwgZG9jLCBzZXREb2MsIGdldERvYywgZ2V0RG9jcywgYWRkRG9jLCB1cGRhdGVEb2MsIGRlbGV0ZURvYywgb25TbmFwc2hvdCwgcXVlcnkgfSBmcm9tICdmaXJlYmFzZS9maXJlc3RvcmUnO1xuXG4gIGNvbnN0IHsgUGVuTGluZSwgU3BhcmtsZXMsIENoZWNrLCBDaGV2cm9uUmlnaHQsIENoZXZyb25MZWZ0LCBBcnJvd0xlZnQsIEVkaXQyLCBUcmFzaDIsIE1lbnUsIENvcHksIFJlZnJlc2hDdywgWCwgQWxlcnRDaXJjbGUgfSA9IEx1Y2lkZUljb25zO1xuXG4gIGNvbnN0IGZpcmViYXNlQ29uZmlnID0ge1wiYXBpS2V5XCI6XCJBSXphU3lCTHc5OWhkWXd6UUthV0ZhY1YzSGRJQXNhX2FkQW5hOWtcIixcImF1dGhEb21haW5cIjpcImtvdG9iYWtvLWVjNjg2LmZpcmViYXNlYXBwLmNvbVwiLFwicHJvamVjdElkXCI6XCJrb3RvYmFrby1lYzY4NlwiLFwic3RvcmFnZUJ1Y2tldFwiOlwia290b2Jha28tZWM2ODYuZmlyZWJhc2VzdG9yYWdlLmFwcFwiLFwibWVzc2FnaW5nU2VuZGVySWRcIjpcIjgzNjYyMDI1NzgyNFwiLFwiYXBwSWRcIjpcIjE6ODM2NjIwMjU3ODI0OndlYjo1YTc2YmYwZTY0NmUzN2YxZmI0YTQ1XCIsXCJtZWFzdXJlbWVudElkXCI6XCJHLTlYRENDWjFCRE1cIn07XG4gIGNvbnN0IGFwcCA9IGluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpO1xuICBjb25zdCBhdXRoID0gZ2V0QXV0aChhcHApO1xuICBjb25zdCBkYiA9IGdldEZpcmVzdG9yZShhcHApO1xuICBjb25zdCBhcHBJZCA9ICdrb3RvLW5vLWhhLWFwcCc7XG4gIGNvbnN0IENBVEVHT1JJRVMgPSBbXCLlv4PjgavmrovjgaPjgZ9cIiwgXCLmlrDjgZ/jgarmsJfjgaXjgY1cIiwgXCLjgYrjgoLjgZfjgo3jgYRcIiwgXCLlvbnnq4vjgaHjgZ3jgYZcIl07XG5cbiAgY29uc3QgZ2VuZXJhdGVTaG9ydENvZGUgPSAoKSA9PiB7XG4gICAgICBjb25zdCBjaGFycyA9ICdBQkNERUZHSEpLTE1OUFFSU1RVVldYWVoyMzQ1Njc4OSc7XG4gICAgICBsZXQgcmVzdWx0ID0gJyc7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgcmVzdWx0ICs9IGNoYXJzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFycy5sZW5ndGgpKTtcbiAgICAgIHJlc3VsdCArPSAnLSc7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgcmVzdWx0ICs9IGNoYXJzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFycy5sZW5ndGgpKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgY29uc3QgSGVhZGVyID0gKHsgb25UaXRsZUNsaWNrLCBsZWZ0QWN0aW9ucywgcmlnaHRBY3Rpb25zIH0pID0+IChcbiAgICAgIDxoZWFkZXIgY2xhc3NOYW1lPVwiZml4ZWQgdG9wLTAgbGVmdC0wIHJpZ2h0LTAgei01MCBoLTE2IGJnLXN0b25lLTUwLzkwIGJhY2tkcm9wLWJsdXItbWQgYm9yZGVyLWIgYm9yZGVyLXN0b25lLTIwMCBweC02IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBzaGFkb3ctc21cIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInctMjAgZmxleCBqdXN0aWZ5LXN0YXJ0IGl0ZW1zLWNlbnRlclwiPntsZWZ0QWN0aW9uc308L2Rpdj5cbiAgICAgICAgICA8aDEgb25DbGljaz17b25UaXRsZUNsaWNrfSBjbGFzc05hbWU9XCJ0ZXh0LXhsIGZvbnQtc2VyaWYgZm9udC1ib2xkIHRyYWNraW5nLXRpZ2h0IHRleHQtc3RvbmUtODAwIGN1cnNvci1kZWZhdWx0IHNlbGVjdC1ub25lIGFjdGl2ZTpvcGFjaXR5LTcwIHRyYW5zaXRpb24tb3BhY2l0eVwiIHRpdGxlPVwi44OI44Oq44OX44Or44Kv44Oq44OD44Kv44Gn44OA44Km44Oz44Ot44O844OJXCI+S290b2Jha288L2gxPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidy0yMCBmbGV4IGp1c3RpZnktZW5kIGl0ZW1zLWNlbnRlciBnYXAtMVwiPntyaWdodEFjdGlvbnN9PC9kaXY+XG4gICAgICA8L2hlYWRlcj5cbiAgKTtcblxuICBjb25zdCBTeW5jU2V0dGluZ3NWaWV3ID0gKHsgY3VycmVudFNob3J0Q29kZSwgaXNMb2FkaW5nQ29kZSwgZXJyb3JNc2csIG9uUmV0cnlDb2RlLCBvblN5bmNDb2RlLCBvblJlcXVlc3RSZXNldCwgc2hvd1RvYXN0IH0pID0+IHtcbiAgICAgIGNvbnN0IFtpbnB1dElkLCBzZXRJbnB1dElkXSA9IHVzZVN0YXRlKCcnKTtcbiAgICAgIGNvbnN0IGhhbmRsZUNvcHkgPSAoKSA9PiB7IGlmICghY3VycmVudFNob3J0Q29kZSB8fCBjdXJyZW50U2hvcnRDb2RlLmxlbmd0aCA8IDgpIHJldHVybjsgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY3VycmVudFNob3J0Q29kZSk7IHNob3dUb2FzdChcIuWQjOacn+OCs+ODvOODieOCkuOCs+ODlOODvOOBl+OBvuOBl+OBn1wiKTsgfTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGgtZnVsbCBtYXgtdy1tZCBteC1hdXRvIHAtNiBwdC02IHBiLTI0IGFuaW1hdGUtZmFkZS1pbiBvdmVyZmxvdy15LWF1dG8gbm8tc2Nyb2xsYmFyXCI+PGRpdiBjbGFzc05hbWU9XCJzcGFjZS15LThcIj48ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktM1wiPjxsYWJlbCBjbGFzc05hbWU9XCJ0ZXh0LXN0b25lLTUwMCB0ZXh0LVsxMHB4XSBmb250LWJvbGQgdHJhY2tpbmctd2lkZXN0IHVwcGVyY2FzZSBibG9jayBtbC0xXCI+44GC44Gq44Gf44Gu5ZCM5pyf44Kz44O844OJPC9sYWJlbD48ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLXdoaXRlIHAtNCByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItc3RvbmUtMjAwIHNoYWRvdy1zbVwiPjxjb2RlIGNsYXNzTmFtZT1cImZsZXgtZ3JvdyB0ZXh0LXhsIGZvbnQtbW9ubyBmb250LWJvbGQgdGV4dC1zdG9uZS04MDAgdHJhY2tpbmctdGlnaHRlciB0ZXh0LWNlbnRlclwiPntpc0xvYWRpbmdDb2RlID8gJy4uLicgOiAoZXJyb3JNc2cgPyAn44Ko44Op44O8JyA6IGN1cnJlbnRTaG9ydENvZGUpfTwvY29kZT48YnV0dG9uIG9uQ2xpY2s9e2hhbmRsZUNvcHl9IGRpc2FibGVkPXshY3VycmVudFNob3J0Q29kZSB8fCBjdXJyZW50U2hvcnRDb2RlLmluY2x1ZGVzKCcuLi4nKX0gY2xhc3NOYW1lPVwicC0yIHRleHQtc3RvbmUtNDAwIGhvdmVyOnRleHQtc3RvbmUtODAwIGJnLXN0b25lLTUwIHJvdW5kZWQtbGcgYWN0aXZlOnNjYWxlLTk1IHRyYW5zaXRpb24tYWxsIGRpc2FibGVkOm9wYWNpdHktMzBcIj48Q29weSBzaXplPXsyMH0gLz48L2J1dHRvbj48L2Rpdj57ZXJyb3JNc2cgJiYgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiB0ZXh0LXJlZC00MDAgdGV4dC14cyBtdC0yXCI+PEFsZXJ0Q2lyY2xlIHNpemU9ezE0fSAvPjxzcGFuPntlcnJvck1zZ308L3NwYW4+PGJ1dHRvbiBvbkNsaWNrPXtvblJldHJ5Q29kZX0gY2xhc3NOYW1lPVwidW5kZXJsaW5lXCI+5YaN6Kmm6KGMPC9idXR0b24+PC9kaXY+fTxwIGNsYXNzTmFtZT1cInRleHQtWzEwcHhdIHRleHQtc3RvbmUtNDAwIGxlYWRpbmctcmVsYXhlZCBpdGFsaWMgcHgtMVwiPuOBk+OBrjjmloflrZfjgpLliKXjga7nq6/mnKvjgaflhaXlipvjgZnjgovjgajjgIHoqIDokYnjgpLlkIzmnJ/jgafjgY3jgb7jgZnjgII8L3A+PC9kaXY+PGRpdiBjbGFzc05hbWU9XCJyZWxhdGl2ZVwiPjxkaXYgY2xhc3NOYW1lPVwiYWJzb2x1dGUgaW5zZXQtMCBmbGV4IGl0ZW1zLWNlbnRlclwiPjxkaXYgY2xhc3NOYW1lPVwidy1mdWxsIGJvcmRlci10IGJvcmRlci1zdG9uZS0xMDBcIj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzTmFtZT1cInJlbGF0aXZlIGZsZXgganVzdGlmeS1jZW50ZXIgdGV4dC1bMTBweF0gdXBwZXJjYXNlXCI+PHNwYW4gY2xhc3NOYW1lPVwiYmctc3RvbmUtNTAgcHgtMyB0ZXh0LXN0b25lLTMwMCBmb250LWJvbGQgdHJhY2tpbmctd2lkZXN0XCI+b3I8L3NwYW4+PC9kaXY+PC9kaXY+PGRpdiBjbGFzc05hbWU9XCJzcGFjZS15LTRcIj48bGFiZWwgY2xhc3NOYW1lPVwidGV4dC1zdG9uZS01MDAgdGV4dC1bMTBweF0gZm9udC1ib2xkIHRyYWNraW5nLXdpZGVzdCB1cHBlcmNhc2UgYmxvY2sgbWwtMVwiPuWIpeOBruOCs+ODvOODieOBqOWQjOacn+OBmeOCizwvbGFiZWw+PGlucHV0IHR5cGU9XCJ0ZXh0XCIgdmFsdWU9e2lucHV0SWR9IG9uQ2hhbmdlPXsoZSkgPT4gc2V0SW5wdXRJZChlLnRhcmdldC52YWx1ZS50b1VwcGVyQ2FzZSgpKX0gcGxhY2Vob2xkZXI9XCLkvos6IEFCQ0QtMTIzNFwiIGNsYXNzTmFtZT1cInctZnVsbCBiZy13aGl0ZSBib3JkZXIgYm9yZGVyLXN0b25lLTIwMCBwLTQgcm91bmRlZC14bCB0ZXh0LWxnIHRleHQtY2VudGVyIGZvY3VzOm91dGxpbmUtbm9uZSBmb2N1czpib3JkZXItc3RvbmUtNDAwIGZvbnQtbW9ubyBmb250LWJvbGQgc2hhZG93LXNtXCIgLz48YnV0dG9uIG9uQ2xpY2s9eygpID0+IG9uU3luY0NvZGUoaW5wdXRJZCl9IGRpc2FibGVkPXshaW5wdXRJZC50cmltKCkgfHwgaW5wdXRJZC5sZW5ndGggPCA5fSBjbGFzc05hbWU9XCJ3LWZ1bGwgcHktNCBiZy1zdG9uZS05MDAgdGV4dC1zdG9uZS01MCByb3VuZGVkLXhsIGZvbnQtYm9sZCB0ZXh0LXNtIHRyYWNraW5nLXdpZGVzdCBkaXNhYmxlZDpvcGFjaXR5LTMwIHRyYW5zaXRpb24tYWxsIGFjdGl2ZTpzY2FsZS1bMC45OF0gc2hhZG93LW1kXCI+5ZCM5pyf44KS6ZaL5aeL44GZ44KLPC9idXR0b24+PHAgY2xhc3NOYW1lPVwidGV4dC1bMTBweF0gdGV4dC1zdG9uZS00MDAgbGVhZGluZy1yZWxheGVkIGl0YWxpYyBweC0xIHRleHQtY2VudGVyXCI+4oC75YWl5Yqb44GX44Gf44Kz44O844OJ44Gu44OH44O844K/44Gr5YiH44KK5pu/44KP44KK44G+44GZ44CCPC9wPjwvZGl2PjxkaXYgY2xhc3NOYW1lPVwicHQtOCBtdC04IGJvcmRlci10IGJvcmRlci1zdG9uZS0xMDBcIj48YnV0dG9uIG9uQ2xpY2s9e29uUmVxdWVzdFJlc2V0fSBjbGFzc05hbWU9XCJ3LWZ1bGwgcHktNCB0ZXh0LXJlZC00MDAgaG92ZXI6dGV4dC1yZWQtNjAwIHRleHQteHMgZm9udC1ib2xkIHRyYWNraW5nLXdpZGVzdCB0cmFuc2l0aW9uLWNvbG9ycyBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMlwiPjxUcmFzaDIgc2l6ZT17MTZ9IC8+PHNwYW4+5YWo44OH44O844K/44KS5YmK6Zmk44GX44Gm5Yid5pyf5YyWPC9zcGFuPjwvYnV0dG9uPjwvZGl2PjwvZGl2PjwvZGl2PlxuICAgICAgKTtcbiAgfTtcbiAgXG4gIGNvbnN0IFRvYXN0ID0gKHsgbWVzc2FnZSwgaXNWaXNpYmxlLCBvbkhpZGUgfSkgPT4ge1xuICAgICAgdXNlRWZmZWN0KCgpID0+IHsgaWYgKGlzVmlzaWJsZSkgeyBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQob25IaWRlLCAyMDAwKTsgcmV0dXJuICgpID0+IGNsZWFyVGltZW91dCh0aW1lcik7IH0gfSwgW2lzVmlzaWJsZSwgb25IaWRlXSk7XG4gICAgICBpZiAoIWlzVmlzaWJsZSkgcmV0dXJuIG51bGw7XG4gICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJmaXhlZCB0b3AtMjAgbGVmdC0xLzIgdHJhbnNmb3JtIC10cmFuc2xhdGUteC0xLzIgei1bMTAwXSBhbmltYXRlLWZhZGUtaW4gcG9pbnRlci1ldmVudHMtbm9uZVwiPjxkaXYgY2xhc3NOYW1lPVwiYmctc3RvbmUtODAwIHRleHQtc3RvbmUtNTAgcHgtNCBweS0yIHJvdW5kZWQtZnVsbCBzaGFkb3ctbGcgdGV4dC1zbSBmb250LW1lZGl1bSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBib3JkZXIgYm9yZGVyLXN0b25lLTcwMFwiPjxDaGVjayBzaXplPXsxNH0gLz57bWVzc2FnZX08L2Rpdj48L2Rpdj47XG4gIH07XG4gIGNvbnN0IENvbmZpcm1EaWFsb2cgPSAoeyBpc1Zpc2libGUsIHRpdGxlLCBtZXNzYWdlLCBhY3Rpb25MYWJlbCwgb25Db25maXJtLCBvbkNhbmNlbCB9KSA9PiB7XG4gICAgICBpZiAoIWlzVmlzaWJsZSkgcmV0dXJuIG51bGw7XG4gICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJmaXhlZCBpbnNldC0wIHotWzgwXSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBwLTYgYmctc3RvbmUtOTAwLzQwIGJhY2tkcm9wLWJsdXItc20gYW5pbWF0ZS1mYWRlLWluXCI+PGRpdiBjbGFzc05hbWU9XCJiZy13aGl0ZSByb3VuZGVkLTJ4bCBwLTggbWF4LXcteHMgdy1mdWxsIHNoYWRvdy14bCB0ZXh0LWNlbnRlclwiPjxoMyBjbGFzc05hbWU9XCJ0ZXh0LWxnIGZvbnQtYm9sZCB0ZXh0LXN0b25lLTgwMCBtYi0yIGZvbnQtc2VyaWZcIj57dGl0bGV9PC9oMz48cCBjbGFzc05hbWU9XCJ0ZXh0LXNtIHRleHQtc3RvbmUtNTAwIG1iLTggbGVhZGluZy1yZWxheGVkXCI+e21lc3NhZ2V9PC9wPjxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0zXCI+PGJ1dHRvbiBvbkNsaWNrPXtvbkNvbmZpcm19IGNsYXNzTmFtZT1cInctZnVsbCBweS0zIGJnLXN0b25lLTkwMCB0ZXh0LXN0b25lLTUwIHJvdW5kZWQtbGcgZm9udC1ib2xkIHRleHQtc20gaG92ZXI6Ymctc3RvbmUtODAwIHRyYW5zaXRpb24tY29sb3JzXCI+e2FjdGlvbkxhYmVsfTwvYnV0dG9uPjxidXR0b24gb25DbGljaz17b25DYW5jZWx9IGNsYXNzTmFtZT1cInctZnVsbCBweS0zIGJnLXN0b25lLTEwMCB0ZXh0LXN0b25lLTYwMCByb3VuZGVkLWxnIGZvbnQtYm9sZCB0ZXh0LXNtIGhvdmVyOmJnLXN0b25lLTIwMCB0cmFuc2l0aW9uLWNvbG9yc1wiPuOCreODo+ODs+OCu+ODqzwvYnV0dG9uPjwvZGl2PjwvZGl2PjwvZGl2PjtcbiAgfTtcbiAgLy8gYm90dG9tLTEwIC0+IGJvdHRvbS02IOOBq+S/ruato1xuICBjb25zdCBGbG9hdGluZ1dyaXRlQnV0dG9uID0gKHsgb25DbGljayB9KSA9PiAoPGRpdiBjbGFzc05hbWU9XCJmaXhlZCBib3R0b20tNiBsZWZ0LTAgcmlnaHQtMCBmbGV4IGp1c3RpZnktY2VudGVyIHotNDAgcHgtNiBwb2ludGVyLWV2ZW50cy1ub25lXCI+PGJ1dHRvbiBvbkNsaWNrPXtvbkNsaWNrfSBjbGFzc05hbWU9XCJiZy1zdG9uZS05MDAgdGV4dC1zdG9uZS01MCBweC04IHB5LTQgcm91bmRlZC1mdWxsIHNoYWRvdy0yeGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTMgYm9yZGVyIGJvcmRlci1zdG9uZS03MDAgcG9pbnRlci1ldmVudHMtYXV0byBhY3RpdmU6c2NhbGUtOTUgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMzAwIGhvdmVyOmJnLXN0b25lLTgwMCBhbmltYXRlLWZsb2F0LXVwXCI+PFBlbkxpbmUgc2l6ZT17MjB9IHN0cm9rZVdpZHRoPXsyLjV9IC8+PHNwYW4gY2xhc3NOYW1lPVwidGV4dC1zbSBmb250LWJvbGQgdHJhY2tpbmctd2lkZXN0XCI+6KiY44GZPC9zcGFuPjwvYnV0dG9uPjwvZGl2Pik7XG4gIFxuICBjb25zdCBJbnB1dFZpZXcgPSAoeyBvblNhdmUsIGluaXRpYWxEYXRhID0gbnVsbCB9KSA9PiB7XG4gICAgICBjb25zdCBbdGV4dCwgc2V0VGV4dF0gPSB1c2VTdGF0ZShpbml0aWFsRGF0YSA/IGluaXRpYWxEYXRhLnRleHQgOiAnJyk7XG4gICAgICBjb25zdCBbc291cmNlLCBzZXRTb3VyY2VdID0gdXNlU3RhdGUoaW5pdGlhbERhdGEgPyBpbml0aWFsRGF0YS5zb3VyY2UgOiAnJyk7XG4gICAgICBjb25zdCBbc2VsZWN0ZWRDYXRlZ29yeSwgc2V0U2VsZWN0ZWRDYXRlZ29yeV0gPSB1c2VTdGF0ZShpbml0aWFsRGF0YSA/IGluaXRpYWxEYXRhLmNhdGVnb3J5IDogQ0FURUdPUklFU1swXSk7XG4gICAgICBjb25zdCB0ZXh0YXJlYVJlZiA9IHVzZVJlZihudWxsKTtcbiAgICAgIHVzZUVmZmVjdCgoKSA9PiB7IGlmIChpbml0aWFsRGF0YSkgeyBzZXRUZXh0KGluaXRpYWxEYXRhLnRleHQpOyBzZXRTb3VyY2UoaW5pdGlhbERhdGEuc291cmNlIHx8ICcnKTsgc2V0U2VsZWN0ZWRDYXRlZ29yeShpbml0aWFsRGF0YS5jYXRlZ29yeSk7IH0gZWxzZSB7IHNldFRleHQoJycpOyBzZXRTb3VyY2UoJycpOyBzZXRTZWxlY3RlZENhdGVnb3J5KENBVEVHT1JJRVNbMF0pOyB9IH0sIFtpbml0aWFsRGF0YV0pO1xuICAgICAgdXNlRWZmZWN0KCgpID0+IHsgaWYgKHRleHRhcmVhUmVmLmN1cnJlbnQpIHsgdGV4dGFyZWFSZWYuY3VycmVudC5zdHlsZS5oZWlnaHQgPSAnYXV0byc7IHRleHRhcmVhUmVmLmN1cnJlbnQuc3R5bGUuaGVpZ2h0ID0gYCR7dGV4dGFyZWFSZWYuY3VycmVudC5zY3JvbGxIZWlnaHR9cHhgOyB9IH0sIFt0ZXh0XSk7XG4gICAgICBjb25zdCBoYW5kbGVTYXZlID0gKCkgPT4geyBpZiAodGV4dC50cmltKCkpIG9uU2F2ZSh0ZXh0LCBzb3VyY2UsIHNlbGVjdGVkQ2F0ZWdvcnkpOyB9O1xuICAgICAgY29uc3QgaXNFZGl0TW9kZSA9ICEhaW5pdGlhbERhdGE7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAgIC8vIG92ZXJmbG93LXktYXV0byBuby1zY3JvbGxiYXIg44KS6L+95Yqg44GX44Gm44CB55S76Z2i5Zu65a6a5pmC44KC44K544Kv44Ot44O844Or5Y+v6IO944GrXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGgtZnVsbCBtYXgtdy1tZCBteC1hdXRvIHAtNiBwdC04IHBiLTI0IGFuaW1hdGUtZmFkZS1pbiBvdmVyZmxvdy15LWF1dG8gbm8tc2Nyb2xsYmFyXCI+PGRpdiBjbGFzc05hbWU9XCJmbGV4LWdyb3cgZmxleCBmbGV4LWNvbCBnYXAtNlwiPjxsYWJlbCBjbGFzc05hbWU9XCJ0ZXh0LXN0b25lLTUwMCB0ZXh0LXhzIGZvbnQtYm9sZCB0cmFja2luZy13aWRlc3QgdXBwZXJjYXNlIHNlbGVjdC1ub25lIGN1cnNvci1kZWZhdWx0IGFjdGl2ZTp0ZXh0LXN0b25lLTgwMCB0cmFuc2l0aW9uLWNvbG9yc1wiPntpc0VkaXRNb2RlID8gJ+iogOiRieOCkue3qOmbhuOBmeOCiycgOiAn6KiA6JGJ44KS6KiY44GZJ308L2xhYmVsPjx0ZXh0YXJlYSByZWY9e3RleHRhcmVhUmVmfSB2YWx1ZT17dGV4dH0gb25DaGFuZ2U9eyhlKSA9PiBzZXRUZXh0KGUudGFyZ2V0LnZhbHVlKX0gcGxhY2Vob2xkZXI9XCLlv4PjgavmrovjgaPjgZ/oqIDokYnjgpLlhaXlipsuLi5cIiBjbGFzc05hbWU9XCJ3LWZ1bGwgbWluLWgtWzhyZW1dIGJnLXRyYW5zcGFyZW50IHRleHQtbGcgbGVhZGluZy1yZWxheGVkIHRleHQtc3RvbmUtODAwIHBsYWNlaG9sZGVyOnRleHQtc3RvbmUtMzAwIHJlc2l6ZS1ub25lIGZvY3VzOm91dGxpbmUtbm9uZSBmb250LXNlcmlmIG92ZXJmbG93LWhpZGRlblwiIGF1dG9Gb2N1cz17IWlzRWRpdE1vZGV9IC8+PGlucHV0IHR5cGU9XCJ0ZXh0XCIgdmFsdWU9e3NvdXJjZX0gb25DaGFuZ2U9eyhlKSA9PiBzZXRTb3VyY2UoZS50YXJnZXQudmFsdWUpfSBwbGFjZWhvbGRlcj1cIuWHuuWFuO+8iOS7u+aEj++8iVwiIGNsYXNzTmFtZT1cInctZnVsbCBiZy10cmFuc3BhcmVudCBib3JkZXItYiBib3JkZXItc3RvbmUtMjAwIHB5LTIgbWItNCBmb2N1czpvdXRsaW5lLW5vbmUgZm9jdXM6Ym9yZGVyLXN0b25lLTQwMCB0ZXh0LXNtIGZvbnQtc2VyaWYgdGV4dC1zdG9uZS02MDAgcGxhY2Vob2xkZXI6dGV4dC1zdG9uZS0yMDBcIiAvPjxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0zXCI+PGRpdiBjbGFzc05hbWU9XCJncmlkIGdyaWQtY29scy0yIGdhcC0yXCI+e0NBVEVHT1JJRVMubWFwKChjYXQpID0+ICg8YnV0dG9uIGtleT17Y2F0fSBvbkNsaWNrPXsoKSA9PiBzZXRTZWxlY3RlZENhdGVnb3J5KGNhdCl9IGNsYXNzTmFtZT17YHB5LTMgcHgtMiB0ZXh0LXNtIHJvdW5kZWQgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMjAwIGJvcmRlciAke3NlbGVjdGVkQ2F0ZWdvcnkgPT09IGNhdCA/ICdiZy1zdG9uZS04MDAgdGV4dC1zdG9uZS01MCBib3JkZXItc3RvbmUtODAwIHNoYWRvdy1tZCcgOiAnYmctd2hpdGUgdGV4dC1zdG9uZS02MDAgYm9yZGVyLXN0b25lLTIwMCBob3Zlcjpib3JkZXItc3RvbmUtNDAwJ31gfT57Y2F0fTwvYnV0dG9uPikpfTwvZGl2PjwvZGl2PjwvZGl2PjxkaXYgY2xhc3NOYW1lPVwicHQtNiBwYi00XCI+PGJ1dHRvbiBvbkNsaWNrPXtoYW5kbGVTYXZlfSBkaXNhYmxlZD17IXRleHQudHJpbSgpfSBjbGFzc05hbWU9e2B3LWZ1bGwgcHktNCByb3VuZGVkLWxnIGZvbnQtYm9sZCB0cmFja2luZy13aWRlc3QgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMjAwICR7dGV4dC50cmltKCkgPyAnYmctc3RvbmUtODAwIHRleHQtc3RvbmUtNTAgc2hhZG93LWxnIGhvdmVyOmJnLXN0b25lLTcwMCBhY3RpdmU6c2NhbGUtWzAuOThdJyA6ICdiZy1zdG9uZS0yMDAgdGV4dC1zdG9uZS00MDAgY3Vyc29yLW5vdC1hbGxvd2VkJ31gfT57aXNFZGl0TW9kZSA/ICfmm7TmlrDjgZnjgosnIDogJ+S/neWtmOOBmeOCiyd9PC9idXR0b24+PC9kaXY+PC9kaXY+XG4gICAgICApO1xuICB9O1xuICBjb25zdCBMaXN0VmlldyA9ICh7IHF1b3Rlcywgb25JdGVtQ2xpY2ssIG9uU3RhcnRSYW5kb20gfSkgPT4ge1xuICAgICAgaWYgKHF1b3Rlcy5sZW5ndGggPT09IDApIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtZnVsbCB0ZXh0LXN0b25lLTQwMCBwLTYgdGV4dC1jZW50ZXIgaXRhbGljIGZvbnQtc2VyaWZcIj7jgb7jgaDoqIDokYnjgYzjgYLjgorjgb7jgZvjgpPjgILkuIvjga7jgIzoqJjjgZnjgI3jgYvjgonlp4vjgoHjgb7jgZfjgofjgYbjgII8L2Rpdj47XG4gICAgICByZXR1cm4gKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaC1mdWxsIG92ZXJmbG93LXktYXV0byBtYXgtdy1tZCBteC1hdXRvIHAtNiBwYi0zMiBuby1zY3JvbGxiYXJcIj48ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktNlwiPjxidXR0b24gb25DbGljaz17b25TdGFydFJhbmRvbX0gY2xhc3NOYW1lPVwidy1mdWxsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBwLTYgYmctc3RvbmUtMTAwIGJvcmRlciBib3JkZXItc3RvbmUtMjAwIHJvdW5kZWQtMnhsIGhvdmVyOmJnLXN0b25lLTIwMCB0cmFuc2l0aW9uLWFsbCBncm91cCBhY3RpdmU6c2NhbGUtWzAuOThdXCI+PGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNFwiPjxkaXYgY2xhc3NOYW1lPVwiYmctd2hpdGUgcC0zIHJvdW5kZWQteGwgc2hhZG93LXNtIHRleHQtc3RvbmUtODAwIGdyb3VwLWhvdmVyOnJvdGF0ZS0xMiB0cmFuc2l0aW9uLXRyYW5zZm9ybVwiPjxTcGFya2xlcyBzaXplPXsyNH0gLz48L2Rpdj48ZGl2IGNsYXNzTmFtZT1cInRleHQtbGVmdFwiPjxwIGNsYXNzTmFtZT1cInRleHQtc20gZm9udC1ib2xkIHRleHQtc3RvbmUtODAwIHRyYWNraW5nLXdpZGVyXCI+6KiA6JGJ44Go44Gu5YaN5LyaPC9wPjxwIGNsYXNzTmFtZT1cInRleHQtWzEwcHhdIHRleHQtc3RvbmUtNDAwIGZvbnQtc2VyaWZcIj7jgYTjgaTjgYvjga7oqIDokYnjgavjgIHjgb7jgZ/lh7rkvJrjgYY8L3A+PC9kaXY+PC9kaXY+PENoZXZyb25SaWdodCBjbGFzc05hbWU9XCJ0ZXh0LXN0b25lLTMwMCBncm91cC1ob3Zlcjp0ZXh0LXN0b25lLTUwIHRyYW5zaXRpb24tY29sb3JzXCIgc2l6ZT17MjB9IC8+PC9idXR0b24+e3F1b3Rlcy5tYXAoKHF1b3RlKSA9PiAoPGRpdiBrZXk9e3F1b3RlLmlkfSBvbkNsaWNrPXsoKSA9PiBvbkl0ZW1DbGljayhxdW90ZS5pZCl9IGNsYXNzTmFtZT1cImdyb3VwIGJnLXdoaXRlIHAtNiByb3VuZGVkLTJ4bCBib3JkZXIgYm9yZGVyLXN0b25lLTEwMCBob3Zlcjpib3JkZXItc3RvbmUtMzAwIHRyYW5zaXRpb24tYWxsIGN1cnNvci1wb2ludGVyIGFjdGl2ZTpiZy1zdG9uZS01MCBzaGFkb3ctc20gdGV4dC1sZWZ0XCI+PHAgY2xhc3NOYW1lPVwidGV4dC1iYXNlIGxlYWRpbmctcmVsYXhlZCB0ZXh0LXN0b25lLTgwMCB3aGl0ZXNwYWNlLXByZS13cmFwIG1iLTEgZm9udC1zZXJpZiBsaW5lLWNsYW1wLTNcIj57cXVvdGUudGV4dH08L3A+e3F1b3RlLnNvdXJjZSAmJiA8cCBjbGFzc05hbWU9XCJ0ZXh0LVsxMHB4XSB0ZXh0LXN0b25lLTQwMCBmb250LXNlcmlmIG1iLTMgdHJhY2tpbmctd2lkZVwiPuKAlCB7cXVvdGUuc291cmNlfTwvcD59PGRpdiBjbGFzc05hbWU9XCJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1lbmQgYm9yZGVyLXQgYm9yZGVyLXN0b25lLTUwIHB0LTNcIj48c3BhbiBjbGFzc05hbWU9XCJ0ZXh0LXhzIHRleHQtc3RvbmUtNTAwIGJnLXN0b25lLTEwMCBweC0yIHB5LTEgcm91bmRlZC1sZyBmb250LW1lZGl1bVwiPntxdW90ZS5jYXRlZ29yeX08L3NwYW4+PHNwYW4gY2xhc3NOYW1lPVwidGV4dC1bMTBweF0gdGV4dC1zdG9uZS00MDAgZm9udC1tb25vXCI+e25ldyBEYXRlKHF1b3RlLnRpbWVzdGFtcCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdqYS1KUCcpfTwvc3Bhbj48L2Rpdj48L2Rpdj4pKX08L2Rpdj48L2Rpdj5cbiAgICAgICk7XG4gIH07XG4gIGNvbnN0IFNpbmdsZVF1b3RlVmlldyA9ICh7IHF1b3RlLCBvbk5leHQsIG9uUHJldiwgaGFzTmV4dCwgaGFzUHJldiwgbmV4dExhYmVsLCBuZXh0SWNvbjogTmV4dEljb24sIG9uQ2xvc2UgfSkgPT4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGgtZnVsbCBtYXgtdy1tZCBteC1hdXRvIHAtOCBwYi04IHJlbGF0aXZlIGFuaW1hdGUtZmFkZS1pbiBiZy1zdG9uZS01MCBvdmVyZmxvdy15LWF1dG8gbm8tc2Nyb2xsYmFyXCI+PGRpdiBjbGFzc05hbWU9XCJmbGV4LWdyb3cgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcHktMTBcIj48ZGl2IGNsYXNzTmFtZT1cInctZnVsbCB0ZXh0LWNlbnRlclwiPjxzcGFuIGNsYXNzTmFtZT1cImlubGluZS1ibG9jayBweC0zIHB5LTEgcm91bmRlZC1mdWxsIGJvcmRlciBib3JkZXItc3RvbmUtMjAwIHRleHQteHMgdGV4dC1zdG9uZS01MDAgdHJhY2tpbmctd2lkZSBtYi04XCI+e3F1b3RlLmNhdGVnb3J5fTwvc3Bhbj48ZGl2IGNsYXNzTmFtZT1cInB4LTJcIj48cCBjbGFzc05hbWU9XCJ0ZXh0LXhsIG1kOnRleHQtMnhsIGZvbnQtc2VyaWYgdGV4dC1zdG9uZS04MDAgd2hpdGVzcGFjZS1wcmUtd3JhcCBtYi00IHNlbGVjdC10ZXh0XCIgc3R5bGU9e3sgbGluZUhlaWdodDogJzEuOCcgfX0+e3F1b3RlLnRleHR9PC9wPntxdW90ZS5zb3VyY2UgJiYgPHAgY2xhc3NOYW1lPVwidGV4dC1zbSB0ZXh0LXN0b25lLTUwMCBmb250LXNlcmlmIG1iLThcIj7igJQge3F1b3RlLnNvdXJjZX08L3A+fTxkaXYgY2xhc3NOYW1lPVwibXQtOCBmbGV4IGp1c3RpZnktY2VudGVyIHRleHQtc3RvbmUtMzAwXCI+PGRpdiBjbGFzc05hbWU9XCJoLXB4IHctMTIgYmctc3RvbmUtMzAwXCI+PC9kaXY+PC9kaXY+PHAgY2xhc3NOYW1lPVwibXQtNCB0ZXh0LVsxMHB4XSB0ZXh0LXN0b25lLTQwMCBmb250LW1vbm8gdHJhY2tpbmctd2lkZXN0XCI+e25ldyBEYXRlKHF1b3RlLnRpbWVzdGFtcCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdqYS1KUCcpfTwvcD48L2Rpdj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzTmFtZT1cInB0LTYgcGItMzIgdGV4dC1jZW50ZXJcIj48ZGl2IGNsYXNzTmFtZT1cImZsZXggZ2FwLTMgbWItNiBtaW4taC1bNjRweF1cIj48ZGl2IGNsYXNzTmFtZT1cInctMTZcIj48YnV0dG9uIG9uQ2xpY2s9e29uUHJldn0gZGlzYWJsZWQ9eyFoYXNQcmV2fSBjbGFzc05hbWU9XCJ3LWZ1bGwgaC1mdWxsIGJvcmRlciBib3JkZXItc3RvbmUtMzAwIHJvdW5kZWQtbGcgdGV4dC1zdG9uZS00MDAgZW5hYmxlZDpob3Zlcjp0ZXh0LXN0b25lLTgwMCB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgYmctd2hpdGUgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZGlzYWJsZWQ6b3BhY2l0eS0zMFwiPjxDaGV2cm9uTGVmdCBzaXplPXsyMH0gLz48L2J1dHRvbj48L2Rpdj48ZGl2IGNsYXNzTmFtZT1cImZsZXgtZ3Jvd1wiPjxidXR0b24gb25DbGljaz17b25OZXh0fSBkaXNhYmxlZD17IWhhc05leHR9IGNsYXNzTmFtZT1cInctZnVsbCBoLWZ1bGwgYm9yZGVyIGJvcmRlci1zdG9uZS0zMDAgcm91bmRlZC1sZyB0ZXh0LXN0b25lLTYwMCBlbmFibGVkOmhvdmVyOnRleHQtc3RvbmUtODAwIGhvdmVyOmJvcmRlci1zdG9uZS00MDAgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMjAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIGJnLXdoaXRlIHNoYWRvdy1zbSBkaXNhYmxlZDpvcGFjaXR5LTMwXCI+PHNwYW4gY2xhc3NOYW1lPVwidGV4dC1zbSBmb250LWJvbGQgdHJhY2tpbmctd2lkZXN0XCI+e25leHRMYWJlbH08L3NwYW4+PE5leHRJY29uIHNpemU9ezE2fSAvPjwvYnV0dG9uPjwvZGl2PjwvZGl2PjxidXR0b24gb25DbGljaz17b25DbG9zZX0gY2xhc3NOYW1lPVwidGV4dC14cyB0ZXh0LXN0b25lLTQwMCBob3Zlcjp0ZXh0LXN0b25lLTYwMCB0cmFuc2l0aW9uLWNvbG9ycyB0cmFja2luZy13aWRlc3QgZm9udC1ib2xkIHB5LTIgcHgtNFwiPuS4gOimp+OBq+aIu+OCizwvYnV0dG9uPjwvZGl2PjwvZGl2PlxuICApO1xuXG4gIGNvbnN0IEFwcCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgW3VzZXIsIHNldFVzZXJdID0gdXNlU3RhdGUobnVsbCk7XG4gICAgICAgIGNvbnN0IFtzaG9ydENvZGUsIHNldFNob3J0Q29kZV0gPSB1c2VTdGF0ZSgnJyk7IFxuICAgICAgICBjb25zdCBbaXNMb2FkaW5nQ29kZSwgc2V0SXNMb2FkaW5nQ29kZV0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgICAgIGNvbnN0IFtjb2RlRXJyb3IsIHNldENvZGVFcnJvcl0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICAgICAgY29uc3QgW3N5bmNVc2VySWQsIHNldFN5bmNVc2VySWRdID0gdXNlU3RhdGUobnVsbCk7IFxuICAgICAgICBjb25zdCBbdmlld01vZGUsIHNldFZpZXdNb2RlXSA9IHVzZVN0YXRlKCdsaXN0Jyk7XG4gICAgICAgIGNvbnN0IFtzZWxlY3RlZFF1b3RlSWQsIHNldFNlbGVjdGVkUXVvdGVJZF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICAgICAgY29uc3QgW3JhbmRvbUhpc3RvcnksIHNldFJhbmRvbUhpc3RvcnldID0gdXNlU3RhdGUoW10pO1xuICAgICAgICBjb25zdCBbcXVvdGVzLCBzZXRRdW90ZXNdID0gdXNlU3RhdGUoW10pO1xuICAgICAgICBjb25zdCBbdG9hc3QsIHNldFRvYXN0XSA9IHVzZVN0YXRlKHsgc2hvdzogZmFsc2UsIG1lc3NhZ2U6ICcnIH0pO1xuICAgICAgICBjb25zdCBbZGlhbG9nU3RhdGUsIHNldERpYWxvZ1N0YXRlXSA9IHVzZVN0YXRlKHsgaXNWaXNpYmxlOiBmYWxzZSwgdHlwZTogbnVsbCwgaWQ6IG51bGwgfSk7XG4gICAgICAgIGNvbnN0IFtjbGlja0NvdW50LCBzZXRDbGlja0NvdW50XSA9IHVzZVN0YXRlKDApO1xuICAgICAgICBjb25zdCBjbGlja1RpbWVvdXRSZWYgPSB1c2VSZWYobnVsbCk7XG5cbiAgICAgICAgLy8g44Om44O844K244O85oOF5aCx44KS5Y+W5b6X44O75Yid5pyf5YyW44GZ44KL77yI44Ot44Kw44Kk44Oz5Yem55CG44Gv44GX44Gq44GE77yJXG4gICAgICAgIGNvbnN0IGZldGNoVXNlckRhdGEgPSBhc3luYyAoY3VycmVudFVzZXIpID0+IHtcbiAgICAgICAgICBpZiAoIWN1cnJlbnRVc2VyKSByZXR1cm47XG4gICAgICAgICAgc2V0SXNMb2FkaW5nQ29kZSh0cnVlKTsgXG4gICAgICAgICAgc2V0Q29kZUVycm9yKG51bGwpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1c2VyQ29kZVJlZiA9IGRvYyhkYiwgJ2FydGlmYWN0cycsIGFwcElkLCAncHVibGljJywgJ2RhdGEnLCAndXNlckNvZGVzJywgY3VycmVudFVzZXIudWlkKTtcbiAgICAgICAgICAgIGNvbnN0IGNvZGVTbmFwID0gYXdhaXQgZ2V0RG9jKHVzZXJDb2RlUmVmKTtcbiAgICAgICAgICAgIGlmIChjb2RlU25hcC5leGlzdHMoKSkgeyBcbiAgICAgICAgICAgICAgICBzZXRTaG9ydENvZGUoY29kZVNuYXAuZGF0YSgpLmNvZGUpOyBcbiAgICAgICAgICAgIH0gZWxzZSB7IFxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvZGUgPSBnZW5lcmF0ZVNob3J0Q29kZSgpOyBcbiAgICAgICAgICAgICAgICBhd2FpdCBzZXREb2MoZG9jKGRiLCAnYXJ0aWZhY3RzJywgYXBwSWQsICdwdWJsaWMnLCAnZGF0YScsICdzeW5jQ29kZXMnLCBuZXdDb2RlKSwgeyB1aWQ6IGN1cnJlbnRVc2VyLnVpZCB9KTsgXG4gICAgICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHVzZXJDb2RlUmVmLCB7IGNvZGU6IG5ld0NvZGUgfSk7IFxuICAgICAgICAgICAgICAgIHNldFNob3J0Q29kZShuZXdDb2RlKTsgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZSkgeyBcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZldGNoIEVycm9yOlwiLCBlKTsgXG4gICAgICAgICAgICAgIGxldCBtc2cgPSBcIuaOpee2muOCqOODqeODvFwiOyBcbiAgICAgICAgICAgICAgaWYgKGUuY29kZSA9PT0gJ3Blcm1pc3Npb24tZGVuaWVkJykgbXNnID0gXCLmqKnpmZDjgYzjgYLjgorjgb7jgZvjgpNcIjsgXG4gICAgICAgICAgICAgIHNldENvZGVFcnJvcihtc2cpOyBcbiAgICAgICAgICB9IGZpbmFsbHkgeyBcbiAgICAgICAgICAgICAgc2V0SXNMb2FkaW5nQ29kZShmYWxzZSk7IFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyDjgqLjg5fjg6rotbfli5XmmYLjga7oqo3oqLzjg5Xjg63jg7znm6PoppZcbiAgICAgICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgICAgIC8vIOaYjuekuueahOOBq+awuOe2muWMluOCkuioreWumlxuICAgICAgICAgICAgc2V0UGVyc2lzdGVuY2UoYXV0aCwgYnJvd3NlckxvY2FsUGVyc2lzdGVuY2UpXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IG9uQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCAodSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDml6Ljgavjg63jgrDjgqTjg7PmuIjjgb/vvIjjg6rjg63jg7zjg4nmmYLjgarjganvvInjgb7jgZ/jga/mlrDopo/jg63jgrDjgqTjg7PlrozkuobmmYJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRVc2VyKHUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoVXNlckRhdGEodSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOODpuODvOOCtuODvOOBjOOBhOOBquOBhO+8iOWIneWbnuOCouOCr+OCu+OCueOAgeOBvuOBn+OBr+ODreOCsOOCouOCpuODiOW+jO+8iVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWMv+WQjeODreOCsOOCpOODs+OCkuWun+ihjFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25JbkFub255bW91c2x5KGF1dGgpLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdXRoIEVycm9yOlwiLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1zZyA9IFwi6KqN6Ki844Ko44Op44O8XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmNvZGUgPT09ICdhdXRoL29wZXJhdGlvbi1ub3QtYWxsb3dlZCcpIG1zZyA9IFwi5Yy/5ZCN44Ot44Kw44Kk44Oz44GM54Sh5Yq544Gn44GZXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldENvZGVFcnJvcihtc2cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQZXJzaXN0ZW5jZSBFcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAvLyDjgqjjg6njg7zmmYLjgafjgoLnm6Poppbjga/plovlp4vjgZnjgotcbiAgICAgICAgICAgICAgICAgICAgb25BdXRoU3RhdGVDaGFuZ2VkKGF1dGgsICh1KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih1KSB7IHNldFVzZXIodSk7IGZldGNoVXNlckRhdGEodSk7IH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIFtdKTtcblxuICAgICAgICBjb25zdCBhY3RpdmVVc2VySWQgPSBzeW5jVXNlcklkIHx8ICh1c2VyID8gdXNlci51aWQgOiBudWxsKTtcbiAgICAgICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgICBpZiAoIWFjdGl2ZVVzZXJJZCkgeyBzZXRRdW90ZXMoW10pOyByZXR1cm47IH1cbiAgICAgICAgICBjb25zdCBxID0gcXVlcnkoY29sbGVjdGlvbihkYiwgJ2FydGlmYWN0cycsIGFwcElkLCAndXNlcnMnLCBhY3RpdmVVc2VySWQsICdxdW90ZXMnKSk7XG4gICAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSBvblNuYXBzaG90KHEsIChzbmFwc2hvdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZG9jcyA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTtcbiAgICAgICAgICAgIHNldFF1b3Rlcyhkb2NzLnNvcnQoKGEsIGIpID0+IChiLnRpbWVzdGFtcCB8fCAwKSAtIChhLnRpbWVzdGFtcCB8fCAwKSkpO1xuICAgICAgICAgIH0sIChlcnIpID0+IHsgY29uc29sZS5lcnJvcihcIkZpcmVzdG9yZSBTeW5jIEVycm9yOlwiLCBlcnIpOyB9KTtcbiAgICAgICAgICByZXR1cm4gKCkgPT4gdW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfSwgW2FjdGl2ZVVzZXJJZF0pO1xuXG4gICAgICAgIGNvbnN0IHNob3dUb2FzdCA9IChtZXNzYWdlKSA9PiBzZXRUb2FzdCh7IHNob3c6IHRydWUsIG1lc3NhZ2UgfSk7XG4gICAgICAgIGNvbnN0IGhhbmRsZVN5bmNCeUNvZGUgPSBhc3luYyAoY29kZSkgPT4geyBpZiAoIXVzZXIpIHJldHVybjsgY29uc3QgY2xlYW5Db2RlID0gY29kZS50cmltKCkudG9VcHBlckNhc2UoKTsgdHJ5IHsgY29uc3QgbWFwcGluZ1JlZiA9IGRvYyhkYiwgJ2FydGlmYWN0cycsIGFwcElkLCAncHVibGljJywgJ2RhdGEnLCAnc3luY0NvZGVzJywgY2xlYW5Db2RlKTsgY29uc3QgbWFwcGluZ1NuYXAgPSBhd2FpdCBnZXREb2MobWFwcGluZ1JlZik7IGlmIChtYXBwaW5nU25hcC5leGlzdHMoKSkgeyBzZXRTeW5jVXNlcklkKG1hcHBpbmdTbmFwLmRhdGEoKS51aWQpOyBzZXRWaWV3TW9kZSgnbGlzdCcpOyBzaG93VG9hc3QoXCLlkIzmnJ/jgpLplovlp4vjgZfjgb7jgZfjgZ9cIik7IH0gZWxzZSB7IHNob3dUb2FzdChcIuOCs+ODvOODieOBjOimi+OBpOOBi+OCiuOBvuOBm+OCk1wiKTsgfSB9IGNhdGNoIChlKSB7IHNob3dUb2FzdChcIuWQjOacn+OCqOODqeODvOOBjOeZuueUn+OBl+OBvuOBl+OBn1wiKTsgfSB9O1xuICAgICAgICBjb25zdCBhZGRRdW90ZSA9IGFzeW5jICh0ZXh0LCBzb3VyY2UsIGNhdGVnb3J5KSA9PiB7IGlmICghYWN0aXZlVXNlcklkKSByZXR1cm47IGF3YWl0IGFkZERvYyhjb2xsZWN0aW9uKGRiLCAnYXJ0aWZhY3RzJywgYXBwSWQsICd1c2VycycsIGFjdGl2ZVVzZXJJZCwgJ3F1b3RlcycpLCB7IHRleHQsIHNvdXJjZSwgY2F0ZWdvcnksIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9KTsgc2hvd1RvYXN0KFwi6KiA6JGJ44KS5L+d5a2Y44GX44G+44GX44GfXCIpOyBzZXRWaWV3TW9kZSgnbGlzdCcpOyB9O1xuICAgICAgICBjb25zdCB1cGRhdGVRdW90ZSA9IGFzeW5jICh0ZXh0LCBzb3VyY2UsIGNhdGVnb3J5KSA9PiB7IGlmICghYWN0aXZlVXNlcklkIHx8ICFzZWxlY3RlZFF1b3RlSWQpIHJldHVybjsgYXdhaXQgdXBkYXRlRG9jKGRvYyhkYiwgJ2FydGlmYWN0cycsIGFwcElkLCAndXNlcnMnLCBhY3RpdmVVc2VySWQsICdxdW90ZXMnLCBzZWxlY3RlZFF1b3RlSWQpLCB7IHRleHQsIHNvdXJjZSwgY2F0ZWdvcnkgfSk7IHNob3dUb2FzdChcIuiogOiRieOCkuabtOaWsOOBl+OBvuOBl+OBn1wiKTsgc2V0Vmlld01vZGUocmFuZG9tSGlzdG9yeS5sZW5ndGggPiAwID8gJ3JhbmRvbScgOiAnZGV0YWlsJyk7IH07XG4gICAgICAgIGNvbnN0IGhhbmRsZUNvbmZpcm1BY3Rpb24gPSBhc3luYyAoKSA9PiB7IGlmIChkaWFsb2dTdGF0ZS50eXBlID09PSAncXVvdGUnKSBhd2FpdCBjb25maXJtRGVsZXRlUXVvdGUoKTsgZWxzZSBpZiAoZGlhbG9nU3RhdGUudHlwZSA9PT0gJ2FjY291bnQnKSBhd2FpdCBjb25maXJtUmVzZXRBY2NvdW50KCk7IH07XG4gICAgICAgIGNvbnN0IGNvbmZpcm1EZWxldGVRdW90ZSA9IGFzeW5jICgpID0+IHsgaWYgKCFhY3RpdmVVc2VySWQgfHwgIWRpYWxvZ1N0YXRlLmlkKSByZXR1cm47IGF3YWl0IGRlbGV0ZURvYyhkb2MoZGIsICdhcnRpZmFjdHMnLCBhcHBJZCwgJ3VzZXJzJywgYWN0aXZlVXNlcklkLCAncXVvdGVzJywgZGlhbG9nU3RhdGUuaWQpKTsgc2hvd1RvYXN0KFwi5YmK6Zmk44GX44G+44GX44GfXCIpOyBzZXREaWFsb2dTdGF0ZSh7IGlzVmlzaWJsZTogZmFsc2UsIHR5cGU6IG51bGwsIGlkOiBudWxsIH0pOyBzZXRWaWV3TW9kZSgnbGlzdCcpOyBzZXRTZWxlY3RlZFF1b3RlSWQobnVsbCk7IH07XG4gICAgICAgIGNvbnN0IGNvbmZpcm1SZXNldEFjY291bnQgPSBhc3luYyAoKSA9PiB7IGlmICghdXNlciB8fCAhc2hvcnRDb2RlKSByZXR1cm47IHRyeSB7IGNvbnN0IHF1b3Rlc1JlZiA9IGNvbGxlY3Rpb24oZGIsICdhcnRpZmFjdHMnLCBhcHBJZCwgJ3VzZXJzJywgdXNlci51aWQsICdxdW90ZXMnKTsgY29uc3Qgc25hcCA9IGF3YWl0IGdldERvY3MocXVvdGVzUmVmKTsgY29uc3QgZGVsZXRlUHJvbWlzZXMgPSBzbmFwLmRvY3MubWFwKGQgPT4gZGVsZXRlRG9jKGQucmVmKSk7IGF3YWl0IFByb21pc2UuYWxsKGRlbGV0ZVByb21pc2VzKTsgYXdhaXQgZGVsZXRlRG9jKGRvYyhkYiwgJ2FydGlmYWN0cycsIGFwcElkLCAncHVibGljJywgJ2RhdGEnLCAnc3luY0NvZGVzJywgc2hvcnRDb2RlKSk7IGF3YWl0IGRlbGV0ZURvYyhkb2MoZGIsICdhcnRpZmFjdHMnLCBhcHBJZCwgJ3B1YmxpYycsICdkYXRhJywgJ3VzZXJDb2RlcycsIHVzZXIudWlkKSk7IHNob3dUb2FzdChcIuWIneacn+WMluOBl+OBvuOBl+OBn+OAguODquODreODvOODieOBl+OBvuOBmS4uLlwiKTsgc2V0VGltZW91dCgoKSA9PiB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCksIDE1MDApOyB9IGNhdGNoIChlKSB7IGNvbnNvbGUuZXJyb3IoZSk7IHNob3dUb2FzdChcIuWIneacn+WMluOBq+WkseaVl+OBl+OBvuOBl+OBn1wiKTsgc2V0RGlhbG9nU3RhdGUoeyBpc1Zpc2libGU6IGZhbHNlLCB0eXBlOiBudWxsLCBpZDogbnVsbCB9KTsgfSB9O1xuICAgICAgICBcbiAgICAgICAgLy8g44K/44Kk44OI44Or44KS44Kv44Oq44OD44Kv44GX44Gf44Go44GN44Gu5Yem55CG77yI44OI44Oq44OX44Or44Kv44Oq44OD44Kv44GnSFRNTOODgOOCpuODs+ODreODvOODie+8iVxuICAgICAgICBjb25zdCBoYW5kbGVUaXRsZUNsaWNrID0gKGUpID0+IHtcbiAgICAgICAgICAgIC8vIGRldGFpbOODl+ODreODkeODhuOCo+OBp+OCr+ODquODg+OCr+WbnuaVsOOCkuWPluW+l++8iOaomea6lueahOOBquODluODqeOCpuOCtuS7leanmO+8iVxuICAgICAgICAgICAgaWYgKGUuZGV0YWlsID09PSAzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaHRtbENvbnRlbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbaHRtbENvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L2h0bWwnIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICAgICAgICBhLmhyZWYgPSB1cmw7XG4gICAgICAgICAgICAgICAgYS5kb3dubG9hZCA9ICdpbmRleC5odG1sJztcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xuICAgICAgICAgICAgICAgIGEuY2xpY2soKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpO1xuICAgICAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcbiAgICAgICAgICAgICAgICBzaG93VG9hc3QoXCJIVE1M44OV44Kh44Kk44Or44KS44OA44Km44Oz44Ot44O844OJ44GX44G+44GX44GfXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRRdW90ZUluZGV4ID0gcXVvdGVzLmZpbmRJbmRleChxID0+IHEuaWQgPT09IHNlbGVjdGVkUXVvdGVJZCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRRdW90ZSA9IHF1b3Rlc1tjdXJyZW50UXVvdGVJbmRleF07XG5cbiAgICAgICAgbGV0IGxlZnRBY3Rpb25zID0gbnVsbDsgbGV0IHJpZ2h0QWN0aW9ucyA9IG51bGw7XG4gICAgICAgIHN3aXRjaCAodmlld01vZGUpIHtcbiAgICAgICAgICBjYXNlICdsaXN0JzogcmlnaHRBY3Rpb25zID0gPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnc2V0dGluZ3MnKX0gY2xhc3NOYW1lPVwicC0yIC1tci0yIHRleHQtc3RvbmUtNDAwIGhvdmVyOnRleHQtc3RvbmUtODAwIHRyYW5zaXRpb24tY29sb3JzXCI+PE1lbnUgc2l6ZT17MjR9IC8+PC9idXR0b24+OyBicmVhaztcbiAgICAgICAgICBjYXNlICdpbnB1dCc6IGNhc2UgJ3NldHRpbmdzJzogcmlnaHRBY3Rpb25zID0gPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnbGlzdCcpfSBjbGFzc05hbWU9XCJwLTIgLW1yLTIgdGV4dC1zdG9uZS00MDAgaG92ZXI6dGV4dC1zdG9uZS04MDAgdHJhbnNpdGlvbi1jb2xvcnNcIj48WCBzaXplPXsyNH0gLz48L2J1dHRvbj47IGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2VkaXQnOiByaWdodEFjdGlvbnMgPSA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHNldFZpZXdNb2RlKHJhbmRvbUhpc3RvcnkubGVuZ3RoID4gMCA/ICdyYW5kb20nIDogJ2RldGFpbCcpfSBjbGFzc05hbWU9XCJwLTIgLW1yLTIgdGV4dC1zdG9uZS00MDAgaG92ZXI6dGV4dC1zdG9uZS04MDAgdHJhbnNpdGlvbi1jb2xvcnNcIj48WCBzaXplPXsyNH0gLz48L2J1dHRvbj47IGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ2RldGFpbCc6IGNhc2UgJ3JhbmRvbSc6IGxlZnRBY3Rpb25zID0gPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiB7IHNldFZpZXdNb2RlKCdsaXN0Jyk7IHNldFJhbmRvbUhpc3RvcnkoW10pOyBzZXRTZWxlY3RlZFF1b3RlSWQobnVsbCk7IH19IGNsYXNzTmFtZT1cInAtMiAtbWwtMiB0ZXh0LXN0b25lLTQwMCBob3Zlcjp0ZXh0LXN0b25lLTgwMCB0cmFuc2l0aW9uLWNvbG9yc1wiPjxBcnJvd0xlZnQgc2l6ZT17MjR9IC8+PC9idXR0b24+OyByaWdodEFjdGlvbnMgPSAoPGRpdiBjbGFzc05hbWU9XCJmbGV4IGdhcC0xIC1tci0yXCI+PGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXREaWFsb2dTdGF0ZSh7IGlzVmlzaWJsZTogdHJ1ZSwgdHlwZTogJ3F1b3RlJywgaWQ6IHNlbGVjdGVkUXVvdGVJZCB9KX0gY2xhc3NOYW1lPVwicC0yIHRleHQtc3RvbmUtNDAwIGhvdmVyOnRleHQtcmVkLTUwMCB0cmFuc2l0aW9uLWNvbG9yc1wiPjxUcmFzaDIgc2l6ZT17MjB9IC8+PC9idXR0b24+PGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnZWRpdCcpfSBjbGFzc05hbWU9XCJwLTIgdGV4dC1zdG9uZS00MDAgaG92ZXI6dGV4dC1zdG9uZS04MDAgdHJhbnNpdGlvbi1jb2xvcnNcIj48RWRpdDIgc2l6ZT17MjB9IC8+PC9idXR0b24+PC9kaXY+KTsgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXVzZXIpIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImgtc2NyZWVuIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGZvbnQtc2VyaWYgdGV4dC1zdG9uZS00MDAgaXRhbGljXCI+6Kqt44G/6L6844G/5LitLi4uPC9kaXY+O1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLy8gbWluLWgtc2NyZWVuIC0+IGgtWzEwMGR2aF0g44Gr5aSJ5pu044GX44Gm44CB5YWo5L2T44K544Kv44Ot44O844Or44KS6Ziy44GQXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJoLVsxMDBkdmhdIGJnLXN0b25lLTUwIHRleHQtc3RvbmUtODAwIGZvbnQtc2FucyBzZWxlY3Rpb246Ymctc3RvbmUtMjAwIG92ZXJmbG93LWhpZGRlbiBmbGV4IGZsZXgtY29sXCI+XG4gICAgICAgICAgICAgIDxzdHlsZT57YEBtZWRpYSAobWluLXdpZHRoOiA2NDBweCkgeyBib2R5IHsgcGFkZGluZy10b3A6IDE2cHg7IH0gfWB9PC9zdHlsZT5cbiAgICAgICAgICAgICAgPEhlYWRlciBvblRpdGxlQ2xpY2s9e2hhbmRsZVRpdGxlQ2xpY2t9IGxlZnRBY3Rpb25zPXtsZWZ0QWN0aW9uc30gcmlnaHRBY3Rpb25zPXtyaWdodEFjdGlvbnN9IC8+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleC1ncm93IG92ZXJmbG93LWhpZGRlbiByZWxhdGl2ZVwiIHN0eWxlPXt7IHBhZGRpbmdUb3A6ICc2NHB4JyB9fT5cbiAgICAgICAgICAgICAgICAgIDxtYWluIGNsYXNzTmFtZT1cImgtZnVsbCByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW5cIj5cbiAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdpbnB1dCcgJiYgPElucHV0VmlldyBvblNhdmU9e2FkZFF1b3RlfSAvPn1cbiAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdsaXN0JyAmJiA8TGlzdFZpZXcgcXVvdGVzPXtxdW90ZXN9IG9uSXRlbUNsaWNrPXsoaWQpID0+IHsgc2V0U2VsZWN0ZWRRdW90ZUlkKGlkKTsgc2V0Vmlld01vZGUoJ2RldGFpbCcpOyB9fSBvblN0YXJ0UmFuZG9tPXsoKSA9PiB7IGlmIChxdW90ZXMubGVuZ3RoID4gMCkgeyBjb25zdCBmaXJzdCA9IHF1b3Rlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBxdW90ZXMubGVuZ3RoKV07IHNldFNlbGVjdGVkUXVvdGVJZChmaXJzdC5pZCk7IHNldFJhbmRvbUhpc3RvcnkoW2ZpcnN0LmlkXSk7IHNldFZpZXdNb2RlKCdyYW5kb20nKTsgfSB9fSAvPn1cbiAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdkZXRhaWwnICYmIGN1cnJlbnRRdW90ZSAmJiA8U2luZ2xlUXVvdGVWaWV3IHF1b3RlPXtjdXJyZW50UXVvdGV9IG9uTmV4dD17KCkgPT4gc2V0U2VsZWN0ZWRRdW90ZUlkKHF1b3Rlc1soY3VycmVudFF1b3RlSW5kZXggKyAxKSAlIHF1b3Rlcy5sZW5ndGhdLmlkKX0gb25QcmV2PXsoKSA9PiBzZXRTZWxlY3RlZFF1b3RlSWQocXVvdGVzWyhjdXJyZW50UXVvdGVJbmRleCAtIDEgKyBxdW90ZXMubGVuZ3RoKSAlIHF1b3Rlcy5sZW5ndGhdLmlkKX0gaGFzTmV4dD17Y3VycmVudFF1b3RlSW5kZXggPCBxdW90ZXMubGVuZ3RoIC0gMX0gaGFzUHJldj17Y3VycmVudFF1b3RlSW5kZXggPiAwfSBuZXh0TGFiZWw9XCLmrKHjga7oqIDokYnjgbhcIiBuZXh0SWNvbj17Q2hldnJvblJpZ2h0fSBvbkNsb3NlPXsoKSA9PiBzZXRWaWV3TW9kZSgnbGlzdCcpfSAvPn1cbiAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdyYW5kb20nICYmIGN1cnJlbnRRdW90ZSAmJiA8U2luZ2xlUXVvdGVWaWV3IHF1b3RlPXtjdXJyZW50UXVvdGV9IG9uTmV4dD17KCkgPT4geyBsZXQgbjsgZG8geyBuID0gcXVvdGVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHF1b3Rlcy5sZW5ndGgpXS5pZDsgfSB3aGlsZSAobiA9PT0gc2VsZWN0ZWRRdW90ZUlkICYmIHF1b3Rlcy5sZW5ndGggPiAxKTsgc2V0U2VsZWN0ZWRRdW90ZUlkKG4pOyBzZXRSYW5kb21IaXN0b3J5KHAgPT4gWy4uLnAsIG5dKTsgfX0gb25QcmV2PXsoKSA9PiB7IGNvbnN0IGggPSBbLi4ucmFuZG9tSGlzdG9yeV07IGgucG9wKCk7IGNvbnN0IHAgPSBoW2gubGVuZ3RoIC0gMV07IHNldFNlbGVjdGVkUXVvdGVJZChwKTsgc2V0UmFuZG9tSGlzdG9yeShoKTsgfX0gaGFzTmV4dD17cXVvdGVzLmxlbmd0aCA+IDF9IGhhc1ByZXY9e3JhbmRvbUhpc3RvcnkubGVuZ3RoID4gMX0gbmV4dExhYmVsPVwi5Yil44Gu6KiA6JGJ44Gr5Ye65Lya44GGXCIgbmV4dEljb249e1NwYXJrbGVzfSBvbkNsb3NlPXsoKSA9PiBzZXRWaWV3TW9kZSgnbGlzdCcpfSAvPn1cbiAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdlZGl0JyAmJiBjdXJyZW50UXVvdGUgJiYgPElucHV0VmlldyBpbml0aWFsRGF0YT17Y3VycmVudFF1b3RlfSBvblNhdmU9e3VwZGF0ZVF1b3RlfSAvPn1cbiAgICAgICAgICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdzZXR0aW5ncycgJiYgPFN5bmNTZXR0aW5nc1ZpZXcgY3VycmVudFNob3J0Q29kZT17c2hvcnRDb2RlfSBpc0xvYWRpbmdDb2RlPXtpc0xvYWRpbmdDb2RlfSBlcnJvck1zZz17Y29kZUVycm9yfSBvblJldHJ5Q29kZT17KCkgPT4gZmV0Y2hVc2VyRGF0YSh1c2VyKX0gb25TeW5jQ29kZT17aGFuZGxlU3luY0J5Q29kZX0gb25SZXF1ZXN0UmVzZXQ9eygpID0+IHNldERpYWxvZ1N0YXRlKHsgaXNWaXNpYmxlOiB0cnVlLCB0eXBlOiAnYWNjb3VudCcsIGlkOiBudWxsIH0pfSBzaG93VG9hc3Q9e3Nob3dUb2FzdH0gLz59XG4gICAgICAgICAgICAgICAgICA8L21haW4+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICB7dmlld01vZGUgPT09ICdsaXN0JyAmJiA8RmxvYXRpbmdXcml0ZUJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnaW5wdXQnKX0gLz59XG4gICAgICAgICAgICAgIDxDb25maXJtRGlhbG9nIGlzVmlzaWJsZT17ZGlhbG9nU3RhdGUuaXNWaXNpYmxlfSB0aXRsZT17ZGlhbG9nU3RhdGUudHlwZSA9PT0gJ2FjY291bnQnID8gXCLlhajjg4fjg7zjgr/jgpLliYrpmaTjgZfjgb7jgZnjgYvvvJ9cIiA6IFwi6KiA6JGJ44KS5YmK6Zmk44GX44G+44GZ44GL77yfXCJ9IG1lc3NhZ2U9e2RpYWxvZ1N0YXRlLnR5cGUgPT09ICdhY2NvdW50JyA/IFwi44GC44Gq44Gf44Gu6KiA6JGJ44CB6Kit5a6a44CB5ZCM5pyf44Kz44O844OJ44GM44GZ44G544Gm5YmK6Zmk44GV44KM44CB44Ki44OX44Oq44GM5Yid5pyf5YyW44GV44KM44G+44GZ44CC44GT44Gu5pON5L2c44Gv5Y+W44KK5raI44Gb44G+44Gb44KT44CCXCIgOiBcIuS4gOW6puWJiumZpOOBl+OBn+iogOiRieOBr+WFg+OBq+aIu+OBmeOBk+OBqOOBjOOBp+OBjeOBvuOBm+OCk+OAglwifSBhY3Rpb25MYWJlbD17ZGlhbG9nU3RhdGUudHlwZSA9PT0gJ2FjY291bnQnID8gXCLlhajliYrpmaTjgZfjgabliJ3mnJ/ljJZcIiA6IFwi5YmK6Zmk44GZ44KLXCJ9IG9uQ29uZmlybT17aGFuZGxlQ29uZmlybUFjdGlvbn0gb25DYW5jZWw9eygpID0+IHNldERpYWxvZ1N0YXRlKHsgaXNWaXNpYmxlOiBmYWxzZSwgdHlwZTogbnVsbCwgaWQ6IG51bGwgfSl9IC8+XG4gICAgICAgICAgICAgIDxUb2FzdCBtZXNzYWdlPXt0b2FzdC5tZXNzYWdlfSBpc1Zpc2libGU9e3RvYXN0LnNob3d9IG9uSGlkZT17KCkgPT4gc2V0VG9hc3QocCA9PiAoeyAuLi5wLCBzaG93OiBmYWxzZSB9KSl9IC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gIH07XG4gIGNvbnN0IHJvb3QgPSBjcmVhdGVSb290KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyb290JykpOyByb290LnJlbmRlcig8QXBwIC8+KTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUNFLE9BQU9BLEtBQUssSUFBSUMsUUFBUSxFQUFFQyxTQUFTLEVBQUVDLE1BQU0sUUFB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</script></head>
<body>
<div id="root"><div class="h-[100dvh] bg-stone-50 text-stone-800 font-sans selection:bg-stone-200 overflow-hidden flex flex-col"><style>@media (min-width: 640px) { body { padding-top: 16px; } }</style><header class="fixed top-0 left-0 right-0 z-50 h-16 bg-stone-50/90 backdrop-blur-md border-b border-stone-200 px-6 flex items-center justify-between shadow-sm"><div class="w-20 flex justify-start items-center"></div><h1 class="text-xl font-serif font-bold tracking-tight text-stone-800 cursor-default select-none active:opacity-70 transition-opacity" title="トリプルクリックでダウンロード">Kotobako</h1><div class="w-20 flex justify-end items-center gap-1"><button class="p-2 -mr-2 text-stone-400 hover:text-stone-800 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></header><div class="flex-grow overflow-hidden relative" style="padding-top: 64px;"><main class="h-full relative overflow-hidden"><div class="flex flex-col items-center justify-center h-full text-stone-400 p-6 text-center italic font-serif">まだ言葉がありません。下の「記す」から始めましょう。</div></main></div><div class="fixed bottom-6 left-0 right-0 flex justify-center z-40 px-6 pointer-events-none"><button class="bg-stone-900 text-stone-50 px-8 py-4 rounded-full shadow-2xl flex items-center gap-3 border border-stone-700 pointer-events-auto active:scale-95 transition-all duration-300 hover:bg-stone-800 animate-float-up"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pen-line"><path d="M12 20h9"></path><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"></path></svg><span class="text-sm font-bold tracking-widest">記す</span></button></div></div></div>
<script type="text/babel" data-type="module">
  import React, { useState, useEffect, useRef } from 'react';
  import { createRoot } from 'react-dom/client';
  import * as LucideIcons from 'lucide-react';
  import { initializeApp } from 'firebase/app';
  import { getAuth, signInAnonymously, onAuthStateChanged, setPersistence, browserLocalPersistence } from 'firebase/auth';
  import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, onSnapshot, query } from 'firebase/firestore';

  const { PenLine, Sparkles, Check, ChevronRight, ChevronLeft, ArrowLeft, Edit2, Trash2, Menu, Copy, RefreshCw, X, AlertCircle } = LucideIcons;

  const firebaseConfig = {"apiKey":"AIzaSyBLw99hdYwzQKaWFacV3HdIAsa_adAna9k","authDomain":"kotobako-ec686.firebaseapp.com","projectId":"kotobako-ec686","storageBucket":"kotobako-ec686.firebasestorage.app","messagingSenderId":"836620257824","appId":"1:836620257824:web:5a76bf0e646e37f1fb4a45","measurementId":"G-9XDCCZ1BDM"};
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const appId = 'koto-no-ha-app';
  const CATEGORIES = ["心に残った", "新たな気づき", "おもしろい", "役立ちそう"];

  const generateShortCode = () => {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let result = '';
      for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
      result += '-';
      for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
      return result;
  };

  const Header = ({ onTitleClick, leftActions, rightActions }) => (
      <header className="fixed top-0 left-0 right-0 z-50 h-16 bg-stone-50/90 backdrop-blur-md border-b border-stone-200 px-6 flex items-center justify-between shadow-sm">
          <div className="w-20 flex justify-start items-center">{leftActions}</div>
          <h1 onClick={onTitleClick} className="text-xl font-serif font-bold tracking-tight text-stone-800 cursor-default select-none active:opacity-70 transition-opacity" title="トリプルクリックでダウンロード">Kotobako</h1>
          <div className="w-20 flex justify-end items-center gap-1">{rightActions}</div>
      </header>
  );

  const SyncSettingsView = ({ currentShortCode, isLoadingCode, errorMsg, onRetryCode, onSyncCode, onRequestReset, showToast }) => {
      const [inputId, setInputId] = useState('');
      const handleCopy = () => { if (!currentShortCode || currentShortCode.length < 8) return; navigator.clipboard.writeText(currentShortCode); showToast("同期コードをコピーしました"); };
      return (
          <div className="flex flex-col h-full max-w-md mx-auto p-6 pt-6 pb-24 animate-fade-in overflow-y-auto no-scrollbar"><div className="space-y-8"><div className="space-y-3"><label className="text-stone-500 text-[10px] font-bold tracking-widest uppercase block ml-1">あなたの同期コード</label><div className="flex items-center gap-2 bg-white p-4 rounded-xl border border-stone-200 shadow-sm"><code className="flex-grow text-xl font-mono font-bold text-stone-800 tracking-tighter text-center">{isLoadingCode ? '...' : (errorMsg ? 'エラー' : currentShortCode)}</code><button onClick={handleCopy} disabled={!currentShortCode || currentShortCode.includes('...')} className="p-2 text-stone-400 hover:text-stone-800 bg-stone-50 rounded-lg active:scale-95 transition-all disabled:opacity-30"><Copy size={20} /></button></div>{errorMsg && <div className="flex items-center justify-center gap-2 text-red-400 text-xs mt-2"><AlertCircle size={14} /><span>{errorMsg}</span><button onClick={onRetryCode} className="underline">再試行</button></div>}<p className="text-[10px] text-stone-400 leading-relaxed italic px-1">この8文字を別の端末で入力すると、言葉を同期できます。</p></div><div className="relative"><div className="absolute inset-0 flex items-center"><div className="w-full border-t border-stone-100"></div></div><div className="relative flex justify-center text-[10px] uppercase"><span className="bg-stone-50 px-3 text-stone-300 font-bold tracking-widest">or</span></div></div><div className="space-y-4"><label className="text-stone-500 text-[10px] font-bold tracking-widest uppercase block ml-1">別のコードと同期する</label><input type="text" value={inputId} onChange={(e) => setInputId(e.target.value.toUpperCase())} placeholder="例: ABCD-1234" className="w-full bg-white border border-stone-200 p-4 rounded-xl text-lg text-center focus:outline-none focus:border-stone-400 font-mono font-bold shadow-sm" /><button onClick={() => onSyncCode(inputId)} disabled={!inputId.trim() || inputId.length < 9} className="w-full py-4 bg-stone-900 text-stone-50 rounded-xl font-bold text-sm tracking-widest disabled:opacity-30 transition-all active:scale-[0.98] shadow-md">同期を開始する</button><p className="text-[10px] text-stone-400 leading-relaxed italic px-1 text-center">※入力したコードのデータに切り替わります。</p></div><div className="pt-8 mt-8 border-t border-stone-100"><button onClick={onRequestReset} className="w-full py-4 text-red-400 hover:text-red-600 text-xs font-bold tracking-widest transition-colors flex items-center justify-center gap-2"><Trash2 size={16} /><span>全データを削除して初期化</span></button></div></div></div>
      );
  };
  
  const Toast = ({ message, isVisible, onHide }) => {
      useEffect(() => { if (isVisible) { const timer = setTimeout(onHide, 2000); return () => clearTimeout(timer); } }, [isVisible, onHide]);
      if (!isVisible) return null;
      return <div className="fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] animate-fade-in pointer-events-none"><div className="bg-stone-800 text-stone-50 px-4 py-2 rounded-full shadow-lg text-sm font-medium flex items-center gap-2 border border-stone-700"><Check size={14} />{message}</div></div>;
  };
  const ConfirmDialog = ({ isVisible, title, message, actionLabel, onConfirm, onCancel }) => {
      if (!isVisible) return null;
      return <div className="fixed inset-0 z-[80] flex items-center justify-center p-6 bg-stone-900/40 backdrop-blur-sm animate-fade-in"><div className="bg-white rounded-2xl p-8 max-w-xs w-full shadow-xl text-center"><h3 className="text-lg font-bold text-stone-800 mb-2 font-serif">{title}</h3><p className="text-sm text-stone-500 mb-8 leading-relaxed">{message}</p><div className="space-y-3"><button onClick={onConfirm} className="w-full py-3 bg-stone-900 text-stone-50 rounded-lg font-bold text-sm hover:bg-stone-800 transition-colors">{actionLabel}</button><button onClick={onCancel} className="w-full py-3 bg-stone-100 text-stone-600 rounded-lg font-bold text-sm hover:bg-stone-200 transition-colors">キャンセル</button></div></div></div>;
  };
  // bottom-10 -> bottom-6 に修正
  const FloatingWriteButton = ({ onClick }) => (<div className="fixed bottom-6 left-0 right-0 flex justify-center z-40 px-6 pointer-events-none"><button onClick={onClick} className="bg-stone-900 text-stone-50 px-8 py-4 rounded-full shadow-2xl flex items-center gap-3 border border-stone-700 pointer-events-auto active:scale-95 transition-all duration-300 hover:bg-stone-800 animate-float-up"><PenLine size={20} strokeWidth={2.5} /><span className="text-sm font-bold tracking-widest">記す</span></button></div>);
  
  const InputView = ({ onSave, initialData = null }) => {
      const [text, setText] = useState(initialData ? initialData.text : '');
      const [source, setSource] = useState(initialData ? initialData.source : '');
      const [selectedCategory, setSelectedCategory] = useState(initialData ? initialData.category : CATEGORIES[0]);
      const textareaRef = useRef(null);
      useEffect(() => { if (initialData) { setText(initialData.text); setSource(initialData.source || ''); setSelectedCategory(initialData.category); } else { setText(''); setSource(''); setSelectedCategory(CATEGORIES[0]); } }, [initialData]);
      useEffect(() => { if (textareaRef.current) { textareaRef.current.style.height = 'auto'; textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`; } }, [text]);
      const handleSave = () => { if (text.trim()) onSave(text, source, selectedCategory); };
      const isEditMode = !!initialData;
      return (
          // overflow-y-auto no-scrollbar を追加して、画面固定時もスクロール可能に
          <div className="flex flex-col h-full max-w-md mx-auto p-6 pt-8 pb-24 animate-fade-in overflow-y-auto no-scrollbar"><div className="flex-grow flex flex-col gap-6"><label className="text-stone-500 text-xs font-bold tracking-widest uppercase select-none cursor-default active:text-stone-800 transition-colors">{isEditMode ? '言葉を編集する' : '言葉を記す'}</label><textarea ref={textareaRef} value={text} onChange={(e) => setText(e.target.value)} placeholder="心に残った言葉を入力..." className="w-full min-h-[8rem] bg-transparent text-lg leading-relaxed text-stone-800 placeholder:text-stone-300 resize-none focus:outline-none font-serif overflow-hidden" autoFocus={!isEditMode} /><input type="text" value={source} onChange={(e) => setSource(e.target.value)} placeholder="出典（任意）" className="w-full bg-transparent border-b border-stone-200 py-2 mb-4 focus:outline-none focus:border-stone-400 text-sm font-serif text-stone-600 placeholder:text-stone-200" /><div className="space-y-3"><div className="grid grid-cols-2 gap-2">{CATEGORIES.map((cat) => (<button key={cat} onClick={() => setSelectedCategory(cat)} className={`py-3 px-2 text-sm rounded transition-all duration-200 border ${selectedCategory === cat ? 'bg-stone-800 text-stone-50 border-stone-800 shadow-md' : 'bg-white text-stone-600 border-stone-200 hover:border-stone-400'}`}>{cat}</button>))}</div></div></div><div className="pt-6 pb-4"><button onClick={handleSave} disabled={!text.trim()} className={`w-full py-4 rounded-lg font-bold tracking-widest transition-all duration-200 ${text.trim() ? 'bg-stone-800 text-stone-50 shadow-lg hover:bg-stone-700 active:scale-[0.98]' : 'bg-stone-200 text-stone-400 cursor-not-allowed'}`}>{isEditMode ? '更新する' : '保存する'}</button></div></div>
      );
  };
  const ListView = ({ quotes, onItemClick, onStartRandom }) => {
      if (quotes.length === 0) return <div className="flex flex-col items-center justify-center h-full text-stone-400 p-6 text-center italic font-serif">まだ言葉がありません。下の「記す」から始めましょう。</div>;
      return (
          <div className="h-full overflow-y-auto max-w-md mx-auto p-6 pb-32 no-scrollbar"><div className="space-y-6"><button onClick={onStartRandom} className="w-full flex items-center justify-between p-6 bg-stone-100 border border-stone-200 rounded-2xl hover:bg-stone-200 transition-all group active:scale-[0.98]"><div className="flex items-center gap-4"><div className="bg-white p-3 rounded-xl shadow-sm text-stone-800 group-hover:rotate-12 transition-transform"><Sparkles size={24} /></div><div className="text-left"><p className="text-sm font-bold text-stone-800 tracking-wider">言葉との再会</p><p className="text-[10px] text-stone-400 font-serif">いつかの言葉に、また出会う</p></div></div><ChevronRight className="text-stone-300 group-hover:text-stone-50 transition-colors" size={20} /></button>{quotes.map((quote) => (<div key={quote.id} onClick={() => onItemClick(quote.id)} className="group bg-white p-6 rounded-2xl border border-stone-100 hover:border-stone-300 transition-all cursor-pointer active:bg-stone-50 shadow-sm text-left"><p className="text-base leading-relaxed text-stone-800 whitespace-pre-wrap mb-1 font-serif line-clamp-3">{quote.text}</p>{quote.source && <p className="text-[10px] text-stone-400 font-serif mb-3 tracking-wide">— {quote.source}</p>}<div className="flex justify-between items-end border-t border-stone-50 pt-3"><span className="text-xs text-stone-500 bg-stone-100 px-2 py-1 rounded-lg font-medium">{quote.category}</span><span className="text-[10px] text-stone-400 font-mono">{new Date(quote.timestamp).toLocaleDateString('ja-JP')}</span></div></div>))}</div></div>
      );
  };
  const SingleQuoteView = ({ quote, onNext, onPrev, hasNext, hasPrev, nextLabel, nextIcon: NextIcon, onClose }) => (
      <div className="flex flex-col h-full max-w-md mx-auto p-8 pb-8 relative animate-fade-in bg-stone-50 overflow-y-auto no-scrollbar"><div className="flex-grow flex flex-col items-center justify-center py-10"><div className="w-full text-center"><span className="inline-block px-3 py-1 rounded-full border border-stone-200 text-xs text-stone-500 tracking-wide mb-8">{quote.category}</span><div className="px-2"><p className="text-xl md:text-2xl font-serif text-stone-800 whitespace-pre-wrap mb-4 select-text" style={{ lineHeight: '1.8' }}>{quote.text}</p>{quote.source && <p className="text-sm text-stone-500 font-serif mb-8">— {quote.source}</p>}<div className="mt-8 flex justify-center text-stone-300"><div className="h-px w-12 bg-stone-300"></div></div><p className="mt-4 text-[10px] text-stone-400 font-mono tracking-widest">{new Date(quote.timestamp).toLocaleDateString('ja-JP')}</p></div></div></div><div className="pt-6 pb-32 text-center"><div className="flex gap-3 mb-6 min-h-[64px]"><div className="w-16"><button onClick={onPrev} disabled={!hasPrev} className="w-full h-full border border-stone-300 rounded-lg text-stone-400 enabled:hover:text-stone-800 transition-all duration-200 bg-white flex items-center justify-center disabled:opacity-30"><ChevronLeft size={20} /></button></div><div className="flex-grow"><button onClick={onNext} disabled={!hasNext} className="w-full h-full border border-stone-300 rounded-lg text-stone-600 enabled:hover:text-stone-800 hover:border-stone-400 transition-all duration-200 flex items-center justify-center gap-2 bg-white shadow-sm disabled:opacity-30"><span className="text-sm font-bold tracking-widest">{nextLabel}</span><NextIcon size={16} /></button></div></div><button onClick={onClose} className="text-xs text-stone-400 hover:text-stone-600 transition-colors tracking-widest font-bold py-2 px-4">一覧に戻る</button></div></div>
  );

  const App = () => {
        const [user, setUser] = useState(null);
        const [shortCode, setShortCode] = useState(''); 
        const [isLoadingCode, setIsLoadingCode] = useState(false);
        const [codeError, setCodeError] = useState(null);
        const [syncUserId, setSyncUserId] = useState(null); 
        const [viewMode, setViewMode] = useState('list');
        const [selectedQuoteId, setSelectedQuoteId] = useState(null);
        const [randomHistory, setRandomHistory] = useState([]);
        const [quotes, setQuotes] = useState([]);
        const [toast, setToast] = useState({ show: false, message: '' });
        const [dialogState, setDialogState] = useState({ isVisible: false, type: null, id: null });
        const [clickCount, setClickCount] = useState(0);
        const clickTimeoutRef = useRef(null);

        // ユーザー情報を取得・初期化する（ログイン処理はしない）
        const fetchUserData = async (currentUser) => {
          if (!currentUser) return;
          setIsLoadingCode(true); 
          setCodeError(null);
          try {
            const userCodeRef = doc(db, 'artifacts', appId, 'public', 'data', 'userCodes', currentUser.uid);
            const codeSnap = await getDoc(userCodeRef);
            if (codeSnap.exists()) { 
                setShortCode(codeSnap.data().code); 
            } else { 
                const newCode = generateShortCode(); 
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'syncCodes', newCode), { uid: currentUser.uid }); 
                await setDoc(userCodeRef, { code: newCode }); 
                setShortCode(newCode); 
            }
          } catch (e) { 
              console.error("Fetch Error:", e); 
              let msg = "接続エラー"; 
              if (e.code === 'permission-denied') msg = "権限がありません"; 
              setCodeError(msg); 
          } finally { 
              setIsLoadingCode(false); 
          }
        };

        // アプリ起動時の認証フロー監視
        useEffect(() => {
            // 明示的に永続化を設定
            setPersistence(auth, browserLocalPersistence)
                .then(() => {
                    const unsubscribe = onAuthStateChanged(auth, (u) => {
                        if (u) {
                            // 既にログイン済み（リロード時など）または新規ログイン完了時
                            setUser(u);
                            fetchUserData(u);
                        } else {
                            // ユーザーがいない（初回アクセス、またはログアウト後）
                            // 匿名ログインを実行
                            signInAnonymously(auth).catch((e) => {
                                console.error("Auth Error:", e);
                                let msg = "認証エラー";
                                if (e.code === 'auth/operation-not-allowed') msg = "匿名ログインが無効です";
                                setCodeError(msg);
                            });
                        }
                    });
                    return () => unsubscribe();
                })
                .catch((error) => {
                    console.error("Persistence Error:", error);
                    // エラー時でも監視は開始する
                    onAuthStateChanged(auth, (u) => {
                        if(u) { setUser(u); fetchUserData(u); }
                    });
                });
        }, []);

        const activeUserId = syncUserId || (user ? user.uid : null);
        useEffect(() => {
          if (!activeUserId) { setQuotes([]); return; }
          const q = query(collection(db, 'artifacts', appId, 'users', activeUserId, 'quotes'));
          const unsubscribe = onSnapshot(q, (snapshot) => {
            const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setQuotes(docs.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)));
          }, (err) => { console.error("Firestore Sync Error:", err); });
          return () => unsubscribe();
        }, [activeUserId]);

        const showToast = (message) => setToast({ show: true, message });
        const handleSyncByCode = async (code) => { if (!user) return; const cleanCode = code.trim().toUpperCase(); try { const mappingRef = doc(db, 'artifacts', appId, 'public', 'data', 'syncCodes', cleanCode); const mappingSnap = await getDoc(mappingRef); if (mappingSnap.exists()) { setSyncUserId(mappingSnap.data().uid); setViewMode('list'); showToast("同期を開始しました"); } else { showToast("コードが見つかりません"); } } catch (e) { showToast("同期エラーが発生しました"); } };
        const addQuote = async (text, source, category) => { if (!activeUserId) return; await addDoc(collection(db, 'artifacts', appId, 'users', activeUserId, 'quotes'), { text, source, category, timestamp: Date.now() }); showToast("言葉を保存しました"); setViewMode('list'); };
        const updateQuote = async (text, source, category) => { if (!activeUserId || !selectedQuoteId) return; await updateDoc(doc(db, 'artifacts', appId, 'users', activeUserId, 'quotes', selectedQuoteId), { text, source, category }); showToast("言葉を更新しました"); setViewMode(randomHistory.length > 0 ? 'random' : 'detail'); };
        const handleConfirmAction = async () => { if (dialogState.type === 'quote') await confirmDeleteQuote(); else if (dialogState.type === 'account') await confirmResetAccount(); };
        const confirmDeleteQuote = async () => { if (!activeUserId || !dialogState.id) return; await deleteDoc(doc(db, 'artifacts', appId, 'users', activeUserId, 'quotes', dialogState.id)); showToast("削除しました"); setDialogState({ isVisible: false, type: null, id: null }); setViewMode('list'); setSelectedQuoteId(null); };
        const confirmResetAccount = async () => { if (!user || !shortCode) return; try { const quotesRef = collection(db, 'artifacts', appId, 'users', user.uid, 'quotes'); const snap = await getDocs(quotesRef); const deletePromises = snap.docs.map(d => deleteDoc(d.ref)); await Promise.all(deletePromises); await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'syncCodes', shortCode)); await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'userCodes', user.uid)); showToast("初期化しました。リロードします..."); setTimeout(() => window.location.reload(), 1500); } catch (e) { console.error(e); showToast("初期化に失敗しました"); setDialogState({ isVisible: false, type: null, id: null }); } };
        
        // タイトルをクリックしたときの処理（トリプルクリックでHTMLダウンロード）
        const handleTitleClick = (e) => {
            // detailプロパティでクリック回数を取得（標準的なブラウザ仕様）
            if (e.detail === 3) {
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'index.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast("HTMLファイルをダウンロードしました");
            }
        };

        const currentQuoteIndex = quotes.findIndex(q => q.id === selectedQuoteId);
        const currentQuote = quotes[currentQuoteIndex];

        let leftActions = null; let rightActions = null;
        switch (viewMode) {
          case 'list': rightActions = <button onClick={() => setViewMode('settings')} className="p-2 -mr-2 text-stone-400 hover:text-stone-800 transition-colors"><Menu size={24} /></button>; break;
          case 'input': case 'settings': rightActions = <button onClick={() => setViewMode('list')} className="p-2 -mr-2 text-stone-400 hover:text-stone-800 transition-colors"><X size={24} /></button>; break;
          case 'edit': rightActions = <button onClick={() => setViewMode(randomHistory.length > 0 ? 'random' : 'detail')} className="p-2 -mr-2 text-stone-400 hover:text-stone-800 transition-colors"><X size={24} /></button>; break;
          case 'detail': case 'random': leftActions = <button onClick={() => { setViewMode('list'); setRandomHistory([]); setSelectedQuoteId(null); }} className="p-2 -ml-2 text-stone-400 hover:text-stone-800 transition-colors"><ArrowLeft size={24} /></button>; rightActions = (<div className="flex gap-1 -mr-2"><button onClick={() => setDialogState({ isVisible: true, type: 'quote', id: selectedQuoteId })} className="p-2 text-stone-400 hover:text-red-500 transition-colors"><Trash2 size={20} /></button><button onClick={() => setViewMode('edit')} className="p-2 text-stone-400 hover:text-stone-800 transition-colors"><Edit2 size={20} /></button></div>); break;
        }

        if (!user) return <div className="h-screen flex items-center justify-center font-serif text-stone-400 italic">読み込み中...</div>;

        return (
          // min-h-screen -> h-[100dvh] に変更して、全体スクロールを防ぐ
          <div className="h-[100dvh] bg-stone-50 text-stone-800 font-sans selection:bg-stone-200 overflow-hidden flex flex-col">
              <style>{`@media (min-width: 640px) { body { padding-top: 16px; } }`}</style>
              <Header onTitleClick={handleTitleClick} leftActions={leftActions} rightActions={rightActions} />
              <div className="flex-grow overflow-hidden relative" style={{ paddingTop: '64px' }}>
                  <main className="h-full relative overflow-hidden">
                      {viewMode === 'input' && <InputView onSave={addQuote} />}
                      {viewMode === 'list' && <ListView quotes={quotes} onItemClick={(id) => { setSelectedQuoteId(id); setViewMode('detail'); }} onStartRandom={() => { if (quotes.length > 0) { const first = quotes[Math.floor(Math.random() * quotes.length)]; setSelectedQuoteId(first.id); setRandomHistory([first.id]); setViewMode('random'); } }} />}
                      {viewMode === 'detail' && currentQuote && <SingleQuoteView quote={currentQuote} onNext={() => setSelectedQuoteId(quotes[(currentQuoteIndex + 1) % quotes.length].id)} onPrev={() => setSelectedQuoteId(quotes[(currentQuoteIndex - 1 + quotes.length) % quotes.length].id)} hasNext={currentQuoteIndex < quotes.length - 1} hasPrev={currentQuoteIndex > 0} nextLabel="次の言葉へ" nextIcon={ChevronRight} onClose={() => setViewMode('list')} />}
                      {viewMode === 'random' && currentQuote && <SingleQuoteView quote={currentQuote} onNext={() => { let n; do { n = quotes[Math.floor(Math.random() * quotes.length)].id; } while (n === selectedQuoteId && quotes.length > 1); setSelectedQuoteId(n); setRandomHistory(p => [...p, n]); }} onPrev={() => { const h = [...randomHistory]; h.pop(); const p = h[h.length - 1]; setSelectedQuoteId(p); setRandomHistory(h); }} hasNext={quotes.length > 1} hasPrev={randomHistory.length > 1} nextLabel="別の言葉に出会う" nextIcon={Sparkles} onClose={() => setViewMode('list')} />}
                      {viewMode === 'edit' && currentQuote && <InputView initialData={currentQuote} onSave={updateQuote} />}
                      {viewMode === 'settings' && <SyncSettingsView currentShortCode={shortCode} isLoadingCode={isLoadingCode} errorMsg={codeError} onRetryCode={() => fetchUserData(user)} onSyncCode={handleSyncByCode} onRequestReset={() => setDialogState({ isVisible: true, type: 'account', id: null })} showToast={showToast} />}
                  </main>
              </div>
              {viewMode === 'list' && <FloatingWriteButton onClick={() => setViewMode('input')} />}
              <ConfirmDialog isVisible={dialogState.isVisible} title={dialogState.type === 'account' ? "全データを削除しますか？" : "言葉を削除しますか？"} message={dialogState.type === 'account' ? "あなたの言葉、設定、同期コードがすべて削除され、アプリが初期化されます。この操作は取り消せません。" : "一度削除した言葉は元に戻すことができません。"} actionLabel={dialogState.type === 'account' ? "全削除して初期化" : "削除する"} onConfirm={handleConfirmAction} onCancel={() => setDialogState({ isVisible: false, type: null, id: null })} />
              <Toast message={toast.message} isVisible={toast.show} onHide={() => setToast(p => ({ ...p, show: false }))} />
          </div>
        );
  };
  const root = createRoot(document.getElementById('root')); root.render(<App />);
</script>

</body></html>